!function(a){if(window.Hls=a(),"object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Hls=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners)&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function d(){this.removeListener(a,d),c||(c=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var c=!1;return d.listener=b,this.on(a,d),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){return this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(b,c,d){!function(b){var e=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,f=/^([^\/;?#]*)(.*)$/,g=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,i={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),!(b=b.trim())){if(!c.alwaysNormalize)return a;var d=this.parseURL(a);if(!g)throw new Error("Error trying to parse base URL.");return d.path=i.normalizePath(d.path),i.buildURLFromParts(d)}var e=this.parseURL(b);if(!e)throw new Error("Error trying to parse relative URL.");if(e.scheme)return c.alwaysNormalize?(e.path=i.normalizePath(e.path),i.buildURLFromParts(e)):b;var g=this.parseURL(a);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&"/"!==g.path[0]){var h=f.exec(g.path);g.netLoc=h[1],g.path=h[2]}g.netLoc&&!g.path&&(g.path="/");var j={scheme:g.scheme,netLoc:e.netLoc,path:null,params:e.params,query:e.query,fragment:e.fragment};if(!e.netLoc&&(j.netLoc=g.netLoc,"/"!==e.path[0]))if(e.path){var k=g.path,l=k.substring(0,k.lastIndexOf("/")+1)+e.path;j.path=i.normalizePath(l)}else j.path=g.path,e.params||(j.params=g.params,e.query||(j.query=g.query));return null===j.path&&(j.path=c.alwaysNormalize?i.normalizePath(e.path):e.path),i.buildURLFromParts(j)},parseURL:function(a){var b=e.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(g,"");a.length!==(a=a.replace(h,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};"object"==typeof d&&"object"==typeof c?c.exports=i:"function"==typeof a&&a.amd?a([],function(){return i}):"object"==typeof d?d.URLToolkit=i:b.URLToolkit=i}(this)},{}],3:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function q(a){p[a]=!0;for(var b in e[a][1]){var c=e[a][1][b];p[c]||q(c)}}for(var c,h=Object.keys(f),i=0,j=h.length;i<j;i++){var k=h[i],l=f[k].exports;if(l===a||l&&l.default===a){c=k;break}}if(!c){c=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var m={},i=0,j=h.length;i<j;i++){var k=h[i];m[k]=k}e[c]=[Function(["require","module","exports"],"("+a+")(self)"),m]}var n=Math.floor(Math.pow(16,8)*Math.random()).toString(16),o={};o[c]=c,e[n]=[Function(["require"],"var f = require("+g(c)+");(f.default ? f.default : f)(self);"),o];var p={};q(n);var r="("+d+")({"+Object.keys(p).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(n)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"});if(b&&b.bare)return t;var u=s.createObjectURL(t),v=new Worker(u);return v.objectURL=u,v}},{}],4:[function(a,b,c){"use strict";function n(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.hlsDefaultConfig=void 0;var d=a(5),e=n(d),f=a(6),g=n(f),h=a(7),i=n(h),j=a(8),k=n(j),l=a(45),m=n(l);c.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:e.default,bufferController:g.default,capLevelController:i.default,fpsController:k.default,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{45:45,5:5,6:6,7:7,8:8}],5:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{default:a}}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function r(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=o(e),g=a(26),h=o(g),i=a(29),j=o(i),k=a(25),l=a(43),m=a(41),n=o(m),s=function(a){function b(a){p(this,b);var c=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.FRAG_LOADING,f.default.FRAG_LOADED,f.default.FRAG_BUFFERED,f.default.ERROR));return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.onCheck=c._abandonRulesCheck.bind(c),c}return r(b,a),d(b,[{key:"destroy",value:function(){this.clearTimer(),h.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(b){var c=b.frag;if("main"===c.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var d=this.hls,e=b.frag.level,f=d.levels[e].details.live,g=d.config,h=void 0,i=void 0;f?(h=g.abrEwmaFastLive,i=g.abrEwmaSlowLive):(h=g.abrEwmaFastVoD,i=g.abrEwmaSlowVoD),this._bwEstimator=new n.default(d,i,h,g.abrEwmaDefaultEstimate)}this.fragCurrent=c}}},{key:"_abandonRulesCheck",value:function(){var b=this.hls,c=b.media,d=this.fragCurrent,e=d.loader,g=b.minAutoLevel;if(!e||e.stats&&e.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var h=e.stats;if(c&&(!c.paused&&0!==c.playbackRate||!c.readyState)&&d.autoLevel&&d.level){var i=performance.now()-h.trequest,k=Math.abs(c.playbackRate);if(i>500*d.duration/k){var m=b.levels,n=Math.max(1,h.bw?h.bw/8:1e3*h.loaded/i),o=m[d.level],p=o.realBitrate?Math.max(o.realBitrate,o.bitrate):o.bitrate,q=h.total?h.total:Math.max(h.loaded,Math.round(d.duration*p/8)),r=c.currentTime,s=(q-h.loaded)/n,t=(j.default.bufferInfo(c,r,b.config.maxBufferHole).end-r)/k;if(t<2*d.duration/k&&s>t){var u=void 0,v=void 0;for(v=d.level-1;v>g;v--){var w=m[v].realBitrate?Math.max(m[v].realBitrate,m[v].bitrate):m[v].bitrate;if((u=d.duration*w/(6.4*n))<t)break}u<s&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(d.level-1)+"];bufferStarvationDelay:"+u.toFixed(1)+"<"+s.toFixed(1)+":"+t.toFixed(1)),b.nextLoadLevel=v,this._bwEstimator.sample(i,h.loaded),e.abort(),this.clearTimer(),b.trigger(f.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,stats:h}))}}}}},{key:"onFragLoaded",value:function(b){var c=b.frag;if("main"===c.type&&!isNaN(c.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[c.level],e=(d.loaded?d.loaded.bytes:0)+b.stats.loaded,f=(d.loaded?d.loaded.duration:0)+b.frag.duration;d.loaded={bytes:e,duration:f},d.realBitrate=Math.round(8*e/f)}if(b.frag.bitrateTest){var g=b.stats;g.tparsed=g.tbuffered=g.tload,this.onFragBuffered(b)}}}},{key:"onFragBuffered",value:function(b){var c=b.stats,d=b.frag;if(!(!0===c.aborted||1!==d.loadCounter||"main"!==d.type||isNaN(d.sn)||d.bitrateTest&&c.tload!==c.tbuffered)){var e=c.tparsed-c.trequest;l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(c.tfirst-c.trequest)+"/"+Math.round(c.tload-c.tfirst)+"/"+Math.round(c.tparsed-c.tload)+"/"+Math.round(c.tbuffered-c.tparsed)+"/"+Math.round(8*c.loaded/(c.tbuffered-c.trequest))),this._bwEstimator.sample(e,c.loaded),d.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(b){switch(b.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(b,c,d,e,f,g,h,i,j){for(var k=f;k>=e;k--){var m=j[k],n=m.details,o=n?n.totalduration/n.fragments.length:c,p=!!n&&n.live,q=void 0;q=k<=b?h*d:i*d;var r=j[k].realBitrate?Math.max(j[k].realBitrate,j[k].bitrate):j[k].bitrate,s=r*o/q;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(q)+"/"+r+"/"+o+"/"+g+"/"+s),q>r&&(!s||p||s<g))return k}return-1}},{key:"nextAutoLevel",get:function(){var b=this._nextAutoLevel,c=this._bwEstimator;if(!(-1===b||c&&c.canEstimate()))return b;var d=this._nextABRAutoLevel;return-1!==b&&(d=Math.min(b,d)),d},set:function(b){this._nextAutoLevel=b}},{key:"_nextABRAutoLevel",get:function(){var b=this.hls,c=b.maxAutoLevel,d=b.levels,e=b.config,f=b.minAutoLevel,g=b.media,h=this.lastLoadedFragLevel,i=this.fragCurrent?this.fragCurrent.duration:0,k=g?g.currentTime:0,m=g&&0!==g.playbackRate?Math.abs(g.playbackRate):1,n=this._bwEstimator?this._bwEstimator.getEstimate():e.abrEwmaDefaultEstimate,o=(j.default.bufferInfo(g,k,e.maxBufferHole).end-k)/m,p=this._findBestLevel(h,i,n,f,c,o,e.abrBandWidthFactor,e.abrBandWidthUpFactor,d);if(p>=0)return p;l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var q=i?Math.min(i,e.maxStarvationDelay):e.maxStarvationDelay,r=e.abrBandWidthFactor,s=e.abrBandWidthUpFactor;if(0===o){var t=this.bitrateTestDelay;if(t){q=(i?Math.min(i,e.maxLoadingDelay):e.maxLoadingDelay)-t,l.logger.trace("bitrate test took "+Math.round(1e3*t)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*q)+" ms"),r=s=1}}return p=this._findBestLevel(h,i,n,f,c,o+q,r,s,d),Math.max(p,0)}}]),b}(h.default);c.default=s},{25:25,26:26,27:27,29:29,41:41,43:43}],6:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{default:a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=k(e),g=a(26),h=k(g),i=a(43),j=a(25),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHING,f.default.MEDIA_DETACHING,f.default.MANIFEST_PARSED,f.default.BUFFER_RESET,f.default.BUFFER_APPENDING,f.default.BUFFER_CODECS,f.default.BUFFER_EOS,f.default.BUFFER_FLUSHING,f.default.LEVEL_PTS_UPDATED,f.default.LEVEL_UPDATED));return c._msDuration=null,c._levelDuration=null,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return n(b,a),d(b,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(b){var c=b.type,d=this.tracks.audio;if("audio"===c&&d&&"audio/mpeg"===d.container){var e=this.sourceBuffer.audio;if(Math.abs(e.timestampOffset-b.start)>.1){var g=e.updating;try{e.abort()}catch(a){g=!0,i.logger.warn("can not abort audio buffer: "+a)}g?this.audioTimestampOffset=b.start:(i.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+b.start),e.timestampOffset=b.start)}}}},{key:"onManifestParsed",value:function(b){var c=b.audio,d=b.video,e=0;b.altAudio&&(c||d)&&(e=(c?1:0)+(d?1:0),i.logger.log(e+" sourceBuffer(s) expected")),this.sourceBufferNb=e}},{key:"onMediaAttaching",value:function(b){var c=this.media=b.media;if(c){var d=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),d.addEventListener("sourceopen",this.onmso),d.addEventListener("sourceended",this.onmse),d.addEventListener("sourceclose",this.onmsc),c.src=URL.createObjectURL(d)}}},{key:"onMediaDetaching",value:function(){i.logger.log("media source detaching");var b=this.mediaSource;if(b){if("open"===b.readyState)try{b.endOfStream()}catch(a){i.logger.warn("onMediaDetaching:"+a.message+" while calling endOfStream")}b.removeEventListener("sourceopen",this.onmso),b.removeEventListener("sourceended",this.onmse),b.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(f.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){i.logger.log("media source opened"),this.hls.trigger(f.default.MEDIA_ATTACHED,{media:this.media});var b=this.mediaSource;b&&b.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var b=this.pendingTracks,c=Object.keys(b).length;c&&(this.sourceBufferNb<=c||0===this.sourceBufferNb)&&(this.createSourceBuffers(b),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){i.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){i.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var b=this.sourceBuffer.audio;i.logger.warn("change mpeg audio timestamp offset from "+b.timestampOffset+" to "+this.audioTimestampOffset),b.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var c=this.parent,d=this.segments.reduce(function(a,b){return b.parent===c?a+1:a},0);this.hls.trigger(f.default.BUFFER_APPENDED,{parent:c,pending:d}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(b){i.logger.error("sourceBuffer error:",b),this.hls.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var b=this.sourceBuffer;for(var c in b){var d=b[c];try{this.mediaSource.removeSourceBuffer(d),d.removeEventListener("updateend",this.onsbue),d.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(b){if(0===Object.keys(this.sourceBuffer).length){for(var c in b)this.pendingTracks[c]=b[c];var d=this.mediaSource;d&&"open"===d.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(b){var c=this.sourceBuffer,d=this.mediaSource;for(var e in b)if(!c[e]){var g=b[e],h=g.levelCodec||g.codec,k=g.container+";codecs="+h;i.logger.log("creating sourceBuffer("+k+")");try{var l=c[e]=d.addSourceBuffer(k);l.addEventListener("updateend",this.onsbue),l.addEventListener("error",this.onsbe),this.tracks[e]={codec:h,container:g.container},g.buffer=l}catch(a){i.logger.error("error while trying to add sourceBuffer:"+a.message),this.hls.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:a,mimeType:k})}}this.hls.trigger(f.default.BUFFER_CREATED,{tracks:b})}},{key:"onBufferAppending",value:function(b){this._needsFlush||(this.segments?this.segments.push(b):this.segments=[b],this.doAppending())}},{key:"onBufferAppendFail",value:function(b){i.logger.error("sourceBuffer error:",b.event),this.hls.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(b){var c=this.sourceBuffer,d=b.type;for(var e in c)d&&e!==d||c[e].ended||(c[e].ended=!0,i.logger.log(e+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var b=this.sourceBuffer,c=this.mediaSource;if(!c||"open"!==c.readyState)return void(this._needsEos=!1);for(var d in b){var e=b[d];if(!e.ended)return;if(e.updating)return void(this._needsEos=!0)}i.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{c.endOfStream()}catch(a){i.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(b){this.flushRange.push({start:b.startOffset,end:b.endOffset,type:b.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(b){var c=b.details;0!==c.fragments.length&&(this._levelDuration=c.totalduration+c.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var b=this.media,c=this.mediaSource,d=this.sourceBuffer,e=this._levelDuration;if(null!==e&&b&&c&&d&&0!==b.readyState&&"open"===c.readyState){for(var f in d)if(d[f].updating)return;null===this._msDuration&&(this._msDuration=c.duration);var g=b.duration;(e>this._msDuration&&e>g||g===1/0||isNaN(g))&&(i.logger.log("Updating mediasource duration to "+e.toFixed(3)),this._msDuration=c.duration=e)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var b=this.flushRange[0];if(!this.flushBuffer(b.start,b.end,b.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var c=0,d=this.sourceBuffer;try{for(var e in d)c+=d[e].buffered.length}catch(a){i.logger.error("error while accessing sourceBuffer.buffered")}this.appended=c,this.hls.trigger(f.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var b=this.hls,c=this.sourceBuffer,d=this.segments;if(Object.keys(c).length){if(this.media.error)return this.segments=[],void i.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(d&&d.length){var e=d.shift();try{var g=e.type,h=c[g];h?h.updating?d.unshift(e):(h.ended=!1,this.parent=e.parent,h.appendBuffer(e.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(a){i.logger.error("error while trying to append buffer:"+a.message),d.unshift(e);var k={type:j.ErrorTypes.MEDIA_ERROR,parent:e.parent};if(22===a.code)return this.segments=[],k.details=j.ErrorDetails.BUFFER_FULL_ERROR,k.fatal=!1,void b.trigger(f.default.ERROR,k);if(this.appendError?this.appendError++:this.appendError=1,k.details=j.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>b.config.appendErrorMaxRetry)return i.logger.log("fail "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),d=[],k.fatal=!0,void b.trigger(f.default.ERROR,k);k.fatal=!1,b.trigger(f.default.ERROR,k)}}}}},{key:"flushBuffer",value:function(b,c,d){var e,f,g,h,j,k,l=this.sourceBuffer;if(Object.keys(l).length){if(i.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+b+"/"+c),this.flushBufferCounter<this.appended){for(var m in l)if(!d||m===d){if(e=l[m],e.ended=!1,e.updating)return i.logger.warn("cannot flush, sb updating in progress"),!1;try{for(f=0;f<e.buffered.length;f++)if(g=e.buffered.start(f),h=e.buffered.end(f),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&c===Number.POSITIVE_INFINITY?(j=b,k=c):(j=Math.max(g,b),k=Math.min(h,c)),Math.min(k,h)-j>.5)return this.flushBufferCounter++,i.logger.log("flush "+m+" ["+j+","+k+"], of ["+g+","+h+"], pos:"+this.media.currentTime),e.remove(j,k),!1}catch(a){i.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else i.logger.warn("abort flushing too many retries");i.logger.log("buffer flushed")}return!0}}]),b}(h.default);c.default=o},{25:25,26:26,27:27,43:43}],7:[function(a,b,c){"use strict";function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function l(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=i(e),g=a(26),h=i(g),m=function(a){function b(a){return j(this,b),k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.FPS_DROP_LEVEL_CAPPING,f.default.MEDIA_ATTACHING,f.default.MANIFEST_PARSED))}return l(b,a),d(b,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(b){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(b.droppedLevel)||this.restrictedLevels.push(b.droppedLevel)}},{key:"onMediaAttaching",value:function(b){this.media=b.media instanceof HTMLVideoElement?b.media:null}},{key:"onManifestParsed",value:function(b){var c=this.hls;c.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=b.levels,c.firstLevel=this.getMaxLevel(b.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var b=this.levels?this.levels.length:0;if(b){var c=this.hls;c.autoLevelCapping=this.getMaxLevel(b-1),c.autoLevelCapping>this.autoLevelCapping&&c.streamController.nextLevelSwitch(),this.autoLevelCapping=c.autoLevelCapping}}}},{key:"getMaxLevel",value:function(b){var c=0,d=void 0,e=void 0,f=this.mediaWidth,g=this.mediaHeight,h=0,i=0;for(d=0;d<=b&&(e=this.levels[d],!this.isLevelRestricted(d))&&(c=d,h=e.width,i=e.height,!(f<=h||g<=i));d++);return c}},{key:"isLevelRestricted",value:function(b){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(b))}},{key:"contentScaleFactor",get:function(){var b=1;try{b=window.devicePixelRatio}catch(a){}return b}},{key:"mediaWidth",get:function(){var b=void 0,c=this.media;return c&&(b=c.clientWidth||c.offsetWidth||c.width,b*=this.contentScaleFactor),b}},{key:"mediaHeight",get:function(){var b=void 0,c=this.media;return c&&(b=c.clientHeight||c.offsetHeight||c.height,b*=this.contentScaleFactor),b}}]),b}(h.default);c.default=m},{26:26,27:27}],8:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function m(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=j(e),g=a(26),h=j(g),i=a(43),n=function(a){function b(a){return k(this,b),l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHING))}return m(b,a),d(b,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(b){var c=this.hls.config;if(c.capLevelOnFPSDrop){"function"==typeof(this.video=b.media instanceof HTMLVideoElement?b.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),c.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(b,c,d){var e=performance.now();if(c){if(this.lastTime){var g=e-this.lastTime,h=d-this.lastDroppedFrames,j=c-this.lastDecodedFrames,k=1e3*h/g,l=this.hls;if(l.trigger(f.default.FPS_DROP,{currentDropped:h,currentDecoded:j,totalDroppedFrames:d}),k>0&&h>l.config.fpsDroppedMonitoringThreshold*j){var m=l.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=m)&&(m-=1,l.trigger(f.default.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:l.currentLevel}),l.autoLevelCapping=m,l.streamController.nextLevelSwitch())}}this.lastTime=e,this.lastDroppedFrames=d,this.lastDecodedFrames=c}}},{key:"checkFPSInterval",value:function(){var b=this.video;if(b)if(this.isVideoPlaybackQualityAvailable){var c=b.getVideoPlaybackQuality();this.checkFPS(b,c.totalVideoFrames,c.droppedVideoFrames)}else this.checkFPS(b,b.webkitDecodedFrameCount,b.webkitDroppedFrameCount)}}]),b}(h.default);c.default=n},{26:26,27:27,43:43}],9:[function(a,b,c){"use strict";function m(a){return a&&a.__esModule?a:{default:a}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function o(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function p(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=m(e),g=a(26),h=m(g),i=a(43),j=a(25),k=a(29),l=m(k),q=function(a){function b(a){n(this,b);var c=o(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MANIFEST_LOADED,f.default.LEVEL_LOADED,f.default.FRAG_LOADED,f.default.ERROR));return c.ontick=c.tick.bind(c),c._manualLevel=-1,c}return p(b,a),d(b,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var b=this._levels;b&&b.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(b){var e,c=[],d=[],g={},h=!1,k=!1,l=this.hls,m=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(b,c){return MediaSource.isTypeSupported(b+"/mp4;codecs="+c)};if(b.levels.forEach(function(a){a.videoCodec&&(h=!0),m&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),(a.audioCodec||a.attrs&&a.attrs.AUDIO)&&(k=!0);var b=g[a.bitrate];void 0===b?(g[a.bitrate]=c.length,a.url=[a.url],a.urlId=0,c.push(a)):c[b].url.push(a.url)}),h&&k?c.forEach(function(a){a.videoCodec&&d.push(a)}):d=c,d=d.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||n("audio",b))&&(!c||n("video",c))}),d.length){e=d[0].bitrate,d.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=d;for(var o=0;o<d.length;o++)if(d[o].bitrate===e){this._firstLevel=o,i.logger.log("manifest loaded,"+d.length+" level(s) found, first bitrate:"+e);break}l.trigger(f.default.MANIFEST_PARSED,{levels:d,firstLevel:this._firstLevel,stats:b.stats,audio:k,video:h,altAudio:b.audioTracks.length>0})}else l.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:l.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(b){var c=this._levels,d=this.hls;if(b>=0&&b<c.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==b){i.logger.log("switching to level "+b),this._level=b;var e=c[b];e.level=b,d.trigger(f.default.LEVEL_SWITCH,e),d.trigger(f.default.LEVEL_SWITCHING,e)}var g=c[b],h=g.details;if(!h||!0===h.live){var k=g.urlId;d.trigger(f.default.LEVEL_LOADING,{url:g.url[k],level:b,id:k})}}else d.trigger(f.default.ERROR,{type:j.ErrorTypes.OTHER_ERROR,details:j.ErrorDetails.LEVEL_SWITCH_ERROR,level:b,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(b){if(!b.fatal){var c=b.details,d=this.hls,e=void 0,f=void 0,g=!1;switch(c){case j.ErrorDetails.FRAG_LOAD_ERROR:case j.ErrorDetails.FRAG_LOAD_TIMEOUT:case j.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case j.ErrorDetails.KEY_LOAD_ERROR:case j.ErrorDetails.KEY_LOAD_TIMEOUT:e=b.frag.level;break;case j.ErrorDetails.LEVEL_LOAD_ERROR:case j.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=b.context.level,g=!0;break;case j.ErrorDetails.REMUX_ALLOC_ERROR:e=b.level}if(void 0!==e){f=this._levels[e],f.loadError?f.loadError++:f.loadError=1;var h=f.url.length;if(h>1&&f.loadError<h)f.urlId=(f.urlId+1)%h,f.details=void 0,i.logger.warn("level controller,"+c+" for level "+e+": switching to redundant stream id "+f.urlId);else{if(-1===this._manualLevel&&e)i.logger.warn("level controller,"+c+": switch-down for next fragment"),d.nextAutoLevel=Math.max(0,e-1);else if(f&&f.details&&f.details.live)i.logger.warn("level controller,"+c+" on live stream, discard"),g&&(this._level=void 0);else if(c===j.ErrorDetails.LEVEL_LOAD_ERROR||c===j.ErrorDetails.LEVEL_LOAD_TIMEOUT){var m=d.media,n=m&&l.default.isBuffered(m,m.currentTime)&&l.default.isBuffered(m,m.currentTime+.5);if(n){var o=d.config.levelLoadingRetryDelay;i.logger.warn("level controller,"+c+", but media buffered, retry in "+o+"ms"),this.timer=setTimeout(this.ontick,o)}else i.logger.error("cannot recover "+c+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),b.fatal=!0}}}}}},{key:"onFragLoaded",value:function(b){var c=b.frag;if(c&&"main"===c.type){var d=this._levels[c.level];d&&(d.loadError=0)}}},{key:"onLevelLoaded",value:function(b){var c=b.level;if(c===this._level){var d=this._levels[c];d.loadError=0;var e=b.details;if(e.live){var f=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),g=d.details;g&&e.endSN===g.endSN&&(f/=2,i.logger.log("same live playlist, reload twice faster")),f-=performance.now()-b.stats.trequest,f=Math.max(1e3,Math.round(f)),i.logger.log("live playlist, reload in "+f+" ms"),this.timer=setTimeout(this.ontick,f)}else this.timer=null}}},{key:"tick",value:function(){var b=this._level;if(void 0!==b&&this.canload){var c=this._levels[b];if(c&&c.url){var d=c.urlId;this.hls.trigger(f.default.LEVEL_LOADING,{url:c.url[d],level:b,id:d})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(b){var c=this._levels;c&&c.length>b&&(this._level===b&&void 0!==c[b].details||this.setLevelInternal(b))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(b){this._manualLevel=b,void 0===this._startLevel&&(this._startLevel=b),-1!==b&&(this.level=b)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(b){this._firstLevel=b}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var b=this.hls.config.startLevel;return void 0!==b?b:this._firstLevel}return this._startLevel},set:function(b){this._startLevel=b}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(b){this.level=b,-1===this._manualLevel&&(this.hls.nextAutoLevel=b)}}]),b}(h.default);c.default=q},{25:25,26:26,27:27,29:29,43:43}],10:[function(a,b,c){"use strict";function u(a){return a&&a.__esModule?a:{default:a}}function v(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function w(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function x(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(40),f=u(e),g=a(29),h=u(g),i=a(19),j=u(i),k=a(27),l=u(k),m=a(26),n=u(m),o=a(30),p=u(o),q=a(44),r=u(q),s=a(25),t=a(43),y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){v(this,b);var c=w(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.LEVEL_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_LOAD_EMERGENCY_ABORTED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_SWITCHED,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c}return x(b,a),d(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),n.default.prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(b){if(this.levels){var c=this.lastCurrentTime,d=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var e=d.startLevel;-1===e&&(e=0,this.bitrateTest=!0),this.level=d.nextLoadLevel=e,this.loadedmetadata=!1}c>0&&-1===b&&(t.logger.log("override startPosition with lastCurrentTime @"+c.toFixed(3)),b=c),this.state=y.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=b,this.tick()}else this.forceStartLoad=!0,this.state=y.STOPPED}},{key:"stopLoad",value:function(){var b=this.fragCurrent;b&&(b.loader&&b.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case y.ERROR:break;case y.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.IDLE:this._doTickIdle();break;case y.WAITING_LEVEL:var b=this.levels[this.level];b&&b.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var c=performance.now(),d=this.retryDate;(!d||c>=d||this.media&&this.media.seeking)&&(t.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.ERROR:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var b=this.hls,c=b.config,d=this.media;if(void 0===this.levelLastLoaded||d||!this.startFragRequested&&c.startFragPrefetch){var e=void 0;e=this.loadedmetadata?d.currentTime:this.nextLoadPosition;var f=b.nextLoadLevel,g=this.levels[f],i=g.bitrate,j=void 0;j=i?Math.max(8*c.maxBufferSize/i,c.maxBufferLength):c.maxBufferLength,j=Math.min(j,c.maxMaxBufferLength);var k=h.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:d,e,c.maxBufferHole),m=k.len;if(!(m>=j)){t.logger.trace("buffer length of "+m.toFixed(3)+" is below max of "+j.toFixed(3)+". checking for more payload ..."),this.level=b.nextLoadLevel=f;var n=g.details;if(void 0===n||n.live&&this.levelLastLoaded!==f)return void(this.state=y.WAITING_LEVEL);var o=this.fragPrevious;if(!n.live&&o&&o.sn===n.endSN){if(Math.min(d.duration,o.start+o.duration)-Math.max(k.end,o.start)<=Math.max(.2,o.duration/2)){var q={};return this.altAudio&&(q.type="video"),this.hls.trigger(l.default.BUFFER_EOS,q),void(this.state=y.ENDED)}}this._fetchPayloadOrEos(e,k,n)}}}},{key:"_fetchPayloadOrEos",value:function(b,c,d){var e=this.fragPrevious,f=this.level,g=d.fragments,h=g.length;if(0!==h){var i=g[0].start,j=g[h-1].start+g[h-1].duration,k=c.end,l=void 0;if(d.initSegment&&!d.initSegment.data)l=d.initSegment;else if(d.live){var m=this.config.initialLiveManifestSize;if(h<m)return void t.logger.warn("Can not start playback of a level, reason: not enough fragments "+h+" < "+m);if(null===(l=this._ensureFragmentAtLivePoint(d,k,i,j,e,g,h)))return}else k<i&&(l=g[0]);l||(l=this._findFragment(i,e,h,g,k,j,d)),l&&this._loadFragmentOrKey(l,f,d,b,k)}}},{key:"_ensureFragmentAtLivePoint",value:function(b,c,d,e,f,g,h){var i=this.hls.config,j=this.media,k=void 0,l=void 0!==i.liveMaxLatencyDuration?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*b.targetduration;if(c<Math.max(d-i.maxFragLookUpTolerance,e-l)){var m=this.liveSyncPosition=this.computeLivePosition(d,b);t.logger.log("buffer end: "+c.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+m.toFixed(3)),c=m,j&&j.readyState&&j.duration>m&&(j.currentTime=m)}if(b.PTSKnown&&c>e&&j&&j.readyState)return null;if(this.startFragRequested&&!b.PTSKnown){if(f){var n=f.sn+1;n>=b.startSN&&n<=b.endSN&&(k=g[n-b.startSN],t.logger.log("live playlist, switching playlist, load frag with next SN: "+k.sn))}k||(k=g[Math.min(h-1,Math.round(h/2))],t.logger.log("live playlist, switching playlist, unknown, load middle frag : "+k.sn))}return k}},{key:"_findFragment",value:function(b,c,d,e,g,h,i){var j=this.hls.config,k=void 0,l=void 0,m=j.maxFragLookUpTolerance,n=c?e[c.sn-e[0].sn+1]:void 0,o=function(b){var c=Math.min(m,b.duration);return b.start+b.duration-c<=g?1:b.start-c>g&&b.start?-1:0};if(g<h?(g>h-m&&(m=0),l=n&&!o(n)?n:f.default.search(e,o)):l=e[d-1],l){k=l;var p=k.sn-i.startSN,q=c&&k.level===c.level,r=e[p-1],s=e[p+1];if(q&&k.sn===c.sn)if(k.sn<i.endSN){var u=c.deltaPTS;u&&u>j.maxBufferHole&&c.dropped&&p?(k=r,t.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),c.loadCounter--):(k=s,t.logger.log("SN just loaded, load next one: "+k.sn))}else k=null;else k.dropped&&!q&&(s&&s.backtracked?(t.logger.warn("Already backtracked from fragment "+(p+1)+", will not backtrack to fragment "+p+". Loading fragment "+(p+1)),k=s):(t.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),k.dropped=0,r?(r.loadCounter&&r.loadCounter--,k=r):k=null))}return k}},{key:"_loadFragmentOrKey",value:function(b,c,d,e,f){var g=this.hls,h=g.config;if(!b.decryptdata||null==b.decryptdata.uri||null!=b.decryptdata.key){if(t.logger.log("Loading "+b.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+c+", currentTime:"+e.toFixed(3)+",bufferEnd:"+f.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,b.loadCounter){b.loadCounter++;var i=h.fragLoadingLoopThreshold;if(b.loadCounter>i&&Math.abs(this.fragLoadIdx-b.loadIdx)<i)return void g.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:b})}else b.loadCounter=1;return b.loadIdx=this.fragLoadIdx,this.fragCurrent=b,this.startFragRequested=!0,isNaN(b.sn)||(this.nextLoadPosition=b.start+b.duration),b.autoLevel=g.autoLevelEnabled,b.bitrateTest=this.bitrateTest,g.trigger(l.default.FRAG_LOADING,{frag:b}),this.demuxer||(this.demuxer=new j.default(g,"main")),void(this.state=y.FRAG_LOADING)}t.logger.log("Loading key for "+b.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+c),this.state=y.KEY_LOADING,g.trigger(l.default.KEY_LOADING,{frag:b})}},{key:"getBufferedFrag",value:function(b){return f.default.search(this._bufferedFrags,function(a){return b<a.startPTS?-1:b>a.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(b){return b?this.getBufferedFrag(b.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var b,c,d=this.media;if(d&&d.readyState&&!1===d.seeking&&(c=d.currentTime,c>d.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=c),h.default.isBuffered(d,c)?b=this.getBufferedFrag(c):h.default.isBuffered(d,c+.1)&&(b=this.getBufferedFrag(c+.1)),b)){var e=b;if(e!==this.fragPlaying){this.hls.trigger(l.default.FRAG_CHANGED,{frag:e});var f=e.level;this.fragPlaying&&this.fragPlaying.level===f||this.hls.trigger(l.default.LEVEL_SWITCHED,{level:f}),this.fragPlaying=e}}}},{key:"immediateLevelSwitch",value:function(){if(t.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var b=this.media,c=void 0;b?(c=b.paused,b.pause()):c=!0,this.previouslyPaused=c}var d=this.fragCurrent;d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var b=this.media;b&&b.buffered.length&&(this.immediateSwitch=!1,h.default.isBuffered(b,b.currentTime)&&(b.currentTime-=1e-4),this.previouslyPaused||b.play())}},{key:"nextLevelSwitch",value:function(){var b=this.media;if(b&&b.readyState){var c=void 0,d=void 0,e=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,d=this.getBufferedFrag(b.currentTime),d&&d.startPTS>1&&this.flushMainBuffer(0,d.startPTS-1),b.paused)c=0;else{var f=this.hls.nextLoadLevel,g=this.levels[f],h=this.fragLastKbps;c=h&&this.fragCurrent?this.fragCurrent.duration*g.bitrate/(1e3*h)+1:0}if((e=this.getBufferedFrag(b.currentTime+c))&&(e=this.followingBufferedFrag(e))){var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(e.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(b,c){this.state=y.BUFFER_FLUSHING;var d={startOffset:b,endOffset:c};this.altAudio&&(d.type="video"),this.hls.trigger(l.default.BUFFER_FLUSHING,d)}},{key:"onMediaAttached",value:function(b){var c=this.media=this.mediaBuffer=b.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),c.addEventListener("seeking",this.onvseeking),c.addEventListener("seeked",this.onvseeked),c.addEventListener("ended",this.onvended);var d=this.config;this.levels&&d.autoStartLoad&&this.hls.startLoad(d.startPosition)}},{key:"onMediaDetaching",value:function(){var b=this.media;b&&b.ended&&(t.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var c=this.levels;c&&c.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0,a.backtracked=void 0})}),b&&(b.removeEventListener("seeking",this.onvseeking),b.removeEventListener("seeked",this.onvseeked),b.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var b=this.media,c=b?b.currentTime:void 0,d=this.config;if(t.logger.log("media seeking to "+c.toFixed(3)),this.state===y.FRAG_LOADING){var e=this.mediaBuffer?this.mediaBuffer:b,f=h.default.bufferInfo(e,c,this.config.maxBufferHole),g=this.fragCurrent;if(0===f.len&&g){var i=d.maxFragLookUpTolerance,j=g.start-i,k=g.start+g.duration+i;c<j||c>k?(g.loader&&(t.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),g.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE):t.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===y.ENDED&&(this.state=y.IDLE);b&&(this.lastCurrentTime=c),this.state!==y.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*d.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=c),this.tick()}},{key:"onMediaSeeked",value:function(){t.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){t.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){t.logger.log("trigger BUFFER_RESET"),this.hls.trigger(l.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(b){var e,c=!1,d=!1;b.levels.forEach(function(a){(e=a.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(c=!0),-1!==e.indexOf("mp4a.40.5")&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&t.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=b.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var f=this.config;(f.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(f.startPosition)}},{key:"onLevelLoaded",value:function(b){var c=b.details,d=b.level,e=this.levels[d],f=c.totalduration,g=0;if(t.logger.log("level "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+f),this.levelLastLoaded=d,c.live){var h=e.details;h&&c.fragments.length>0?(p.default.mergeDetails(h,c),g=c.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(g,h),c.PTSKnown?t.logger.log("live playlist sliding:"+g.toFixed(3)):t.logger.log("live playlist - outdated PTS, unknown sliding")):(c.PTSKnown=!1,t.logger.log("live playlist - first load, unknown sliding"))}else c.PTSKnown=!1;if(e.details=c,this.hls.trigger(l.default.LEVEL_UPDATED,{details:c,level:d}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var i=c.startTimeOffset;isNaN(i)?c.live?(this.startPosition=this.computeLivePosition(g,c),t.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(i<0&&(t.logger.log("negative start time offset "+i+", count from end of last fragment"),i=g+f+i),t.logger.log("start time offset found in playlist, adjust startPosition to "+i),this.startPosition=i),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_LEVEL&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(b){var c=this.fragCurrent,d=b.frag;if(this.state===y.FRAG_LOADING&&c&&"main"===d.type&&d.level===c.level&&d.sn===c.sn){var e=b.stats,f=this.levels[c.level],g=f.details;if(t.logger.log("Loaded  "+c.sn+" of ["+g.startSN+" ,"+g.endSN+"],level "+c.level),this.bitrateTest=!1,this.stats=e,!0===d.bitrateTest&&this.hls.nextLoadLevel)this.state=y.IDLE,this.startFragRequested=!1,e.tparsed=e.tbuffered=performance.now(),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:e,frag:c,id:"main"}),this.tick();else if("initSegment"===d.sn)this.state=y.IDLE,e.tparsed=e.tbuffered=performance.now(),g.initSegment.data=b.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:e,frag:c,id:"main"}),this.tick();else{this.state=y.PARSING;var h=g.totalduration,i=c.level,k=c.sn,m=this.config.defaultAudioCodec||f.audioCodec;this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),void 0===m&&(m=this.lastAudioCodec),m&&(m=-1!==m.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,t.logger.log("Parsing "+k+" of ["+g.startSN+" ,"+g.endSN+"],level "+i+", cc "+c.cc);var n=this.demuxer;n||(n=this.demuxer=new j.default(this.hls,"main"));var o=this.media,p=o&&o.seeking,q=!p&&(g.PTSKnown||!g.live),r=g.initSegment?g.initSegment.data:[];n.push(b.payload,r,m,f.videoCodec,c,h,q,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(b){var c=this.fragCurrent,d=b.frag;if(c&&"main"===b.id&&d.sn===c.sn&&d.level===c.level&&this.state===y.PARSING){var f,g,e=b.tracks;if(e.audio&&this.altAudio&&delete e.audio,g=e.audio){var h=this.levels[this.level].audioCodec,i=navigator.userAgent.toLowerCase();h&&this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),h=-1!==h.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==g.metadata.channelCount&&-1===i.indexOf("firefox")&&(h="mp4a.40.5"),-1!==i.indexOf("android")&&"audio/mpeg"!==g.container&&(h="mp4a.40.2",t.logger.log("Android: force audio codec to "+h)),g.levelCodec=h,g.id=b.id}g=e.video,g&&(g.levelCodec=this.levels[this.level].videoCodec,g.id=b.id),this.hls.trigger(l.default.BUFFER_CODECS,e);for(f in e){g=e[f],t.logger.log("main track:"+f+",container:"+g.container+",codecs[level/parsed]=["+g.levelCodec+"/"+g.codec+"]");var j=g.initSegment;j&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,{type:f,data:j,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"main"===b.id&&e.sn===d.sn&&e.level===d.level&&("audio"!==b.type||!this.altAudio)&&this.state===y.PARSING){var f=this.levels[this.level],g=d;if(isNaN(b.endPTS)&&(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),t.logger.log("Parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb+",dropped:"+(b.dropped||0)),"video"===b.type)if(g.dropped=b.dropped,g.dropped){if(!g.backtracked)return g.backtracked=!0,this.nextLoadPosition=b.startPTS,this.state=y.IDLE,void this.tick();t.logger.warn("Already backtracked on this fragment, appending with the gap")}else g.backtracked=!1;var h=p.default.updateFragPTSDTS(f.details,g.sn,b.startPTS,b.endPTS,b.startDTS,b.endDTS),i=this.hls;i.trigger(l.default.LEVEL_PTS_UPDATED,{details:f.details,level:this.level,drift:h,type:b.type,start:b.startPTS,end:b.endPTS}),[b.data1,b.data2].forEach(function(a){a&&a.length&&c.state===y.PARSING&&(c.appended=!0,c.pendingBuffering=!0,i.trigger(l.default.BUFFER_APPENDING,{type:b.type,data:a,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(b){var c=this.fragCurrent,d=b.frag;c&&"main"===b.id&&d.sn===c.sn&&d.level===c.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(b){var c=!!b.url,d=b.id;if(!c){if(this.mediaBuffer!==this.media){t.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var e=this.fragCurrent;e.loader&&(t.logger.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.IDLE}var f=this.hls;f.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),f.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:d}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(b){var c=b.id,d=!!this.hls.audioTracks[c].url;if(d){var e=this.videoBuffer;e&&this.mediaBuffer!==e&&(t.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=d,this.tick()}},{key:"onBufferCreated",value:function(b){var c=b.tracks,d=void 0,e=void 0,f=!1;for(var g in c){var h=c[g];"main"===h.id?(e=g,d=h,"video"===g&&(this.videoBuffer=c[g].buffer)):f=!0}f&&d?(t.logger.log("alternate track found, use "+e+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(b){if("main"===b.parent){var c=this.state;c!==y.PARSING&&c!==y.PARSED||(this.pendingBuffering=b.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==y.PARSED||this.appended&&this.pendingBuffering)){var b=this.fragCurrent;if(b){var c=this.mediaBuffer?this.mediaBuffer:this.media;t.logger.log("main buffered : "+r.default.toString(c.buffered));var d=this._bufferedFrags.filter(function(a){return h.default.isBuffered(c,(a.startPTS+a.endPTS)/2)});d.push(b),this._bufferedFrags=d.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=b;var e=this.stats;e.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*e.total/(e.tbuffered-e.tfirst)),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:e,frag:b,id:"main"}),this.state=y.IDLE}this.tick()}}},{key:"onError",value:function(b){var c=b.frag||this.fragCurrent;if(!c||"main"===c.type){var d=this.media,e=d&&h.default.isBuffered(d,d.currentTime)&&h.default.isBuffered(d,d.currentTime+.5);switch(b.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(!b.fatal){var f=this.fragLoadError;f?f++:f=1;var g=this.config;if(f<=g.fragLoadingMaxRetry||e||c.autoLevel&&c.level){this.fragLoadError=f,c.loadCounter=0;var i=Math.min(Math.pow(2,f-1)*g.fragLoadingRetryDelay,g.fragLoadingMaxRetryTimeout);t.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=y.FRAG_LOADING_WAITING_RETRY}else t.logger.error("mediaController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=y.ERROR}break;case s.ErrorDetails.FRAG_LOOP_LOADING_ERROR:b.fatal||(e?(this._reduceMaxBufferLength(c.duration),this.state=y.IDLE):c.autoLevel&&0!==c.level||(b.fatal=!0,this.state=y.ERROR));break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.ERROR&&(b.fatal?(this.state=y.ERROR,t.logger.warn("streamController: "+b.details+",switch to "+this.state+" state ...")):this.state===y.WAITING_LEVEL&&(this.state=y.IDLE));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==b.parent||this.state!==y.PARSING&&this.state!==y.PARSED||(e?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.IDLE):(t.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(b){var c=this.config;c.maxMaxBufferLength>=b&&(c.maxMaxBufferLength/=2,t.logger.warn("main:reduce max buffer length to "+c.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*c.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var b=this.media;if(b&&b.readyState){var c=b.currentTime,d=this.mediaBuffer?this.mediaBuffer:b,e=d.buffered;if(!this.loadedmetadata&&e.length){this.loadedmetadata=!0;var f=b.seeking?c:this.startPosition,g=h.default.isBuffered(d,f);c===f&&g||(t.logger.log("target start position:"+f),g||(f=e.start(0),t.logger.log("target start position not buffered, seek to buffered.start(0) "+f)),t.logger.log("adjust currentTime from "+c+" to "+f),b.currentTime=f)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var i=h.default.bufferInfo(b,c,0),j=!(b.paused||b.ended||0===b.buffered.length),k=.5,m=c!==this.lastCurrentTime,n=this.config;if(m)this.stallReported&&(t.logger.warn("playback not stuck anymore @"+c+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(j){var o=performance.now(),p=this.hls;if(this.stalled){var q=o-this.stalled,r=i.len,u=this.nudgeRetry||0;if(r<=k&&q>1e3*n.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,t.logger.warn("playback stalling in low buffer @"+c),p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r}));var v=i.nextStart,w=v-c;if(v&&w<n.maxSeekHole&&w>0){this.nudgeRetry=++u;var x=u*n.nudgeOffset;t.logger.log("adjust currentTime from "+b.currentTime+" to next buffered @ "+v+" + nudge "+x),b.currentTime=v+x,this.stalled=void 0,p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:v+x-c})}}else if(r>k&&q>1e3*n.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,t.logger.warn("playback stalling in high buffer @"+c),p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r})),this.stalled=void 0,this.nudgeRetry=++u,u<n.nudgeMaxRetry){var y=b.currentTime,z=y+u*n.nudgeOffset;t.logger.log("adjust currentTime from "+y+" to "+z),b.currentTime=z,p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else t.logger.error("still stuck in high buffer @"+c+" after "+n.nudgeMaxRetry+", raise fatal error"),p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=o,this.stallReported=!1}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var b=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(a){return h.default.isBuffered(b,(a.startPTS+a.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(b,c){var d=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*c.targetduration;return b+Math.max(0,c.totalduration-d)}},{key:"state",set:function(b){if(this.state!==b){var c=this.state;this._state=b,t.logger.log("main stream:"+c+"->"+b),this.hls.trigger(l.default.STREAM_STATE_TRANSITION,{previousState:c,nextState:b})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var b=this.media;if(b){var c=this.getBufferedFrag(b.currentTime);if(c)return c.level}return-1}},{key:"nextBufferedFrag",get:function(){var b=this.media;return b?this.followingBufferedFrag(this.getBufferedFrag(b.currentTime)):null}},{key:"nextLevel",get:function(){var b=this.nextBufferedFrag;return b?b.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(b){this._liveSyncPosition=b}}]),b}(n.default);c.default=z},{19:19,25:25,26:26,27:27,29:29,30:30,40:40,43:43,44:44}],11:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){e(this,a),this.subtle=b,this.aesIV=c}return d(a,[{key:"decrypt",value:function(b,c){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},c,b)}}]),a}();c.default=f},{}],12:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){e(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return d(a,[{key:"uint8ArrayToUint32Array_",value:function(b){for(var c=new DataView(b),d=new Uint32Array(4),e=0;e<4;e++)d[e]=c.getUint32(4*e);return d}},{key:"initTable",value:function(){var b=this.sBox,c=this.invSBox,d=this.subMix,e=d[0],f=d[1],g=d[2],h=d[3],i=this.invSubMix,j=i[0],k=i[1],l=i[2],m=i[3],n=new Uint32Array(256),o=0,p=0,q=0;for(q=0;q<256;q++)n[q]=q<128?q<<1:q<<1^283;for(q=0;q<256;q++){var r=p^p<<1^p<<2^p<<3^p<<4;r=r>>>8^255&r^99,b[o]=r,c[r]=o;var s=n[o],t=n[s],u=n[t],v=257*n[r]^16843008*r;e[o]=v<<24|v>>>8,f[o]=v<<16|v>>>16,g[o]=v<<8|v>>>24,h[o]=v,v=16843009*u^65537*t^257*s^16843008*o,j[r]=v<<24|v>>>8,k[r]=v<<16|v>>>16,l[r]=v<<8|v>>>24,m[r]=v,o?(o=s^n[n[n[u^s]]],p^=n[n[p]]):o=p=1}}},{key:"expandKey",value:function(b){for(var c=this.uint8ArrayToUint32Array_(b),d=!0,e=0;e<c.length&&d;)d=c[e]===this.key[e],e++;if(!d){this.key=c;var f=this.keySize=c.length;if(4!==f&&6!==f&&8!==f)throw new Error("Invalid aes key size="+f);var g=this.ksRows=4*(f+6+1),h=void 0,i=void 0,j=this.keySchedule=new Uint32Array(g),k=this.invKeySchedule=new Uint32Array(g),l=this.sBox,m=this.rcon,n=this.invSubMix,o=n[0],p=n[1],q=n[2],r=n[3],s=void 0,t=void 0;for(h=0;h<g;h++)h<f?s=j[h]=c[h]:(t=s,h%f==0?(t=t<<8|t>>>24,t=l[t>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[255&t],t^=m[h/f|0]<<24):f>6&&h%f==4&&(t=l[t>>>24]<<24|l[t>>>16&255]<<16|l[t>>>8&255]<<8|l[255&t]),j[h]=s=(j[h-f]^t)>>>0);for(i=0;i<g;i++)h=g-i,t=3&i?j[h]:j[h-4],k[i]=i<4||h<=4?t:o[l[t>>>24]]^p[l[t>>>16&255]]^q[l[t>>>8&255]]^r[l[255&t]],k[i]=k[i]>>>0}}},{key:"networkToHostOrderSwap",value:function(b){return b<<24|(65280&b)<<8|(16711680&b)>>8|b>>>24}},{key:"decrypt",value:function(b,c,d){for(var F,G,e=this.keySize+6,f=this.invKeySchedule,g=this.invSBox,h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=this.uint8ArrayToUint32Array_(d),n=m[0],o=m[1],p=m[2],q=m[3],r=new Int32Array(b),s=new Int32Array(r.length),t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,H=this.networkToHostOrderSwap;c<r.length;){for(B=H(r[c]),C=H(r[c+1]),D=H(r[c+2]),E=H(r[c+3]),x=B^f[0],y=E^f[1],z=D^f[2],A=C^f[3],F=4,G=1;G<e;G++)t=i[x>>>24]^j[y>>16&255]^k[z>>8&255]^l[255&A]^f[F],u=i[y>>>24]^j[z>>16&255]^k[A>>8&255]^l[255&x]^f[F+1],v=i[z>>>24]^j[A>>16&255]^k[x>>8&255]^l[255&y]^f[F+2],w=i[A>>>24]^j[x>>16&255]^k[y>>8&255]^l[255&z]^f[F+3],x=t,y=u,z=v,A=w,F+=4;t=g[x>>>24]<<24^g[y>>16&255]<<16^g[z>>8&255]<<8^g[255&A]^f[F],u=g[y>>>24]<<24^g[z>>16&255]<<16^g[A>>8&255]<<8^g[255&x]^f[F+1],v=g[z>>>24]<<24^g[A>>16&255]<<16^g[x>>8&255]<<8^g[255&y]^f[F+2],w=g[A>>>24]<<24^g[x>>16&255]<<16^g[y>>8&255]<<8^g[255&z]^f[F+3],F+=3,s[c]=H(t^n),s[c+1]=H(w^o),s[c+2]=H(v^p),s[c+3]=H(u^q),n=B,o=C,p=D,q=E,c+=4}return s.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),a}();c.default=f},{}],13:[function(a,b,c){"use strict";function m(a){return a&&a.__esModule?a:{default:a}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(11),f=m(e),g=a(14),h=m(g),i=a(12),j=m(i),k=a(25),l=a(43),o=function(){function a(b,c){n(this,a),this.observer=b,this.config=c,this.logEnabled=!0;try{var d=crypto||self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(a){}this.disableWebCrypto=!this.subtle}return d(a,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(b,c,d,e){var g=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(l.logger.log("JS AES decrypt"),this.logEnabled=!1);var i=this.decryptor;i||(this.decryptor=i=new j.default),i.expandKey(c),e(i.decrypt(b,0,d))}else{this.logEnabled&&(l.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var k=this.subtle;this.key!==c&&(this.key=c,this.fastAesKey=new h.default(k,c)),this.fastAesKey.expandKey().then(function(a){new f.default(k,d).decrypt(b,a).catch(function(a){g.onWebCryptoError(a,b,c,d,e)}).then(function(a){e(a)})}).catch(function(a){g.onWebCryptoError(a,b,c,d,e)})}}},{key:"onWebCryptoError",value:function(b,c,d,e,f){this.config.enableSoftwareAES?(l.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(c,d,e,f)):(l.logger.error("decrypting error : "+b.message),this.observer.trigger(Event.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:b.message}))}},{key:"destroy",value:function(){var b=this.decryptor;b&&(b.destroy(),this.decryptor=void 0)}}]),a}();c.default=o},{11:11,12:12,14:14,25:25,43:43}],14:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){e(this,a),this.subtle=b,this.key=c}return d(a,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),a}();c.default=f},{}],15:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(16),f=j(e),g=a(43),h=a(21),i=j(h),l=function(){function a(b,c,d){k(this,a),this.observer=b,this.config=d,this.remuxer=c}return d(a,[{key:"resetInitSegment",value:function(b,c,d,e){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:c,duration:e,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(b,c,d,e){var h,l,m,n,o,p,q,r,s,t,j=new i.default(b),k=90*j.timeStamp;for(h=this._aacTrack,p=j.length,s=b.length;p<s-1&&(255!==b[p]||240!=(240&b[p+1]));p++);for(h.samplerate||(l=f.default.getAudioConfig(this.observer,b,p,h.manifestCodec),h.config=l.config,h.samplerate=l.samplerate,h.channelCount=l.channelCount,h.codec=l.codec,g.logger.log("parsed codec:"+h.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)),o=0,n=9216e4/h.samplerate;p+5<s&&(q=1&b[p+1]?7:9,m=(3&b[p+3])<<11|b[p+4]<<3|(224&b[p+5])>>>5,(m-=q)>0&&p+q+m<=s);)for(r=k+o*n,t={unit:b.subarray(p+q,p+q+m),pts:r,dts:r},h.samples.push(t),h.len+=m,p+=m+q,o++;p<s-1&&(255!==b[p]||240!=(240&b[p+1]));p++);this.remuxer.remux(h,{samples:[]},{samples:[{pts:k,dts:k,unit:j.payload}]},{samples:[]},c,d,e)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(b){var d,e,c=new i.default(b);if(c.hasTimeStamp)for(d=c.length,e=b.length;d<e-1;d++)if(255===b[d]&&240==(240&b[d+1]))return!0;return!1}}]),a}();c.default=l},{16:16,21:21,43:43}],16:[function(a,b,c){"use strict";var d=a(43),e=a(25),f={getAudioConfig:function(b,c,f,g){var h,i,j,k,l,m=navigator.userAgent.toLowerCase(),n=g,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return h=1+((192&c[f+2])>>>6),(i=(60&c[f+2])>>>2)>o.length-1?void b.trigger(Event.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+i}):(k=(1&c[f+2])<<2,k|=(192&c[f+3])>>>6,d.logger.log("manifest codec:"+g+",ADTS data:type:"+h+",sampleingIndex:"+i+"["+o[i]+"Hz],channelConfig:"+k),/firefox/i.test(m)?i>=6?(h=5,l=new Array(4),j=i-3):(h=2,l=new Array(2),j=i):-1!==m.indexOf("android")?(h=2,l=new Array(2),j=i):(h=5,l=new Array(4),g&&(-1!==g.indexOf("mp4a.40.29")||-1!==g.indexOf("mp4a.40.5"))||!g&&i>=6?j=i-3:((g&&-1!==g.indexOf("mp4a.40.2")&&i>=6&&1===k||!g&&1===k)&&(h=2,l=new Array(2)),j=i)),l[0]=h<<3,l[0]|=(14&i)>>1,l[1]|=(1&i)<<7,l[1]|=k<<3,5===h&&(l[1]|=(14&j)>>1,l[2]=(1&j)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:o[i],channelCount:k,codec:"mp4a.40."+h,manifestCodec:n})}};b.exports=f},{25:25,43:43}],17:[function(a,b,c){"use strict";function t(a){return a&&a.__esModule?a:{default:a}}function u(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=t(e),g=a(25),h=a(13),i=t(h),j=a(15),k=t(j),l=a(22),m=t(l),n=a(24),o=t(n),p=a(37),q=t(p),r=a(38),s=t(r),v=function(){function a(b,c,d,e){u(this,a),this.observer=b,this.typeSupported=c,this.config=d,this.vendor=e}return d(a,[{key:"destroy",value:function(){var b=this.demuxer;b&&b.destroy()}},{key:"push",value:function(b,c,d,e,g,h,j,k,l,m,n,o){if(b.byteLength>0&&null!=c&&null!=c.key&&"AES-128"===c.method){var p=this.decrypter;null==p&&(p=this.decrypter=new i.default(this.observer,this.config));var r,q=this;try{r=performance.now()}catch(a){r=Date.now()}p.decrypt(b,c.key.buffer,c.iv.buffer,function(a){var b;try{b=performance.now()}catch(a){b=Date.now()}q.observer.trigger(f.default.FRAG_DECRYPTED,{stats:{tstart:r,tdecrypt:b}}),q.pushDecrypted(new Uint8Array(a),c,new Uint8Array(d),e,g,h,j,k,l,m,n,o)})}else this.pushDecrypted(new Uint8Array(b),c,new Uint8Array(d),e,g,h,j,k,l,m,n,o)}},{key:"pushDecrypted",value:function(b,c,d,e,h,i,j,l,n,p,r,t){var u=this.demuxer;if(!u||j&&!this.probe(b)){var v=this.observer,w=this.typeSupported,x=this.config,y=[{demux:o.default,remux:q.default},{demux:k.default,remux:q.default},{demux:m.default,remux:s.default}];for(var z in y){var A=y[z],B=A.demux.probe;if(B(b)){var C=this.remuxer=new A.remux(v,x,w,this.vendor);u=new A.demux(v,C,x,w),this.probe=B;break}}if(!u)return void v.trigger(f.default.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=u}var D=this.remuxer;(j||l)&&(u.resetInitSegment(d,e,h,p),D.resetInitSegment()),j&&(u.resetTimeStamp(),D.resetTimeStamp(t)),"function"==typeof u.setDecryptData&&u.setDecryptData(c),u.append(b,i,n,r)}}]),a}();c.default=v},{13:13,15:15,22:22,24:24,25:25,27:27,37:37,38:38}],18:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var d=a(17),e=k(d),f=a(27),g=k(f),h=a(43),i=a(1),j=k(i),l=function(b){var c=new j.default;c.trigger=function(b){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];c.emit.apply(c,[b,b].concat(e))},c.off=function(b){for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];c.removeListener.apply(c,[b].concat(e))};var d=function(c,d){b.postMessage({event:c,data:d})};b.addEventListener("message",function(a){var f=a.data;switch(f.cmd){case"init":var g=JSON.parse(f.config);b.demuxer=new e.default(c,f.typeSupported,g,f.vendor);try{(0,h.enableLogs)(!0===g.debug)}catch(a){console.warn("demuxerWorker: unable to enable logs")}d("init",null);break;case"demux":b.demuxer.push(f.data,f.decryptdata,f.initSegment,f.audioCodec,f.videoCodec,f.timeOffset,f.discontinuity,f.trackSwitch,f.contiguous,f.duration,f.accurateTimeOffset,f.defaultInitPTS)}}),c.on(g.default.FRAG_DECRYPTED,d),c.on(g.default.FRAG_PARSING_INIT_SEGMENT,d),c.on(g.default.FRAG_PARSED,d),c.on(g.default.ERROR,d),c.on(g.default.FRAG_PARSING_METADATA,d),c.on(g.default.FRAG_PARSING_USERDATA,d),c.on(g.default.INIT_PTS_FOUND,d),c.on(g.default.FRAG_PARSING_DATA,function(a,c){var d=[],e={event:a,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),b.postMessage(e,d)})};c.default=l},{1:1,17:17,27:27,43:43}],19:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{default:a}}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=o(e),g=a(17),h=o(g),i=a(18),j=o(i),k=a(43),l=a(25),m=a(1),n=o(m),q=function(){function b(c,d){p(this,b),this.hls=c,this.id=d;var e=this.observer=new n.default,g=c.config;e.trigger=function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];e.emit.apply(e,[b,b].concat(d))},e.off=function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];e.removeListener.apply(e,[b].concat(d))};var i=function(a,b){b=b||{},b.frag=this.frag,b.id=this.id,c.trigger(a,b)}.bind(this);e.on(f.default.FRAG_DECRYPTED,i),e.on(f.default.FRAG_PARSING_INIT_SEGMENT,i),e.on(f.default.FRAG_PARSING_DATA,i),e.on(f.default.FRAG_PARSED,i),e.on(f.default.ERROR,i),e.on(f.default.FRAG_PARSING_METADATA,i),e.on(f.default.FRAG_PARSING_USERDATA,i),e.on(f.default.INIT_PTS_FOUND,i);var m={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(g.enableWorker&&"undefined"!=typeof Worker){k.logger.log("demuxing in webworker");var q=void 0;try{var r=a(3);q=this.w=r(j.default),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(a){c.trigger(f.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:m,vendor:o,id:d,config:JSON.stringify(g)})}catch(a){k.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&URL.revokeObjectURL(q.objectURL),this.demuxer=new h.default(e,m,g,o),this.w=void 0}}else this.demuxer=new h.default(e,m,g,o)}return d(b,[{key:"destroy",value:function(){var b=this.w;if(b)b.removeEventListener("message",this.onwmsg),b.terminate(),this.w=null;else{var c=this.demuxer;c&&(c.destroy(),this.demuxer=null)}var d=this.observer;d&&(d.removeAllListeners(),this.observer=null)}},{key:"push",value:function(b,c,d,e,f,g,h,i){var j=this.w,l=isNaN(f.startDTS)?f.start:f.startDTS,m=f.decryptdata,n=this.frag,o=!(n&&f.cc===n.cc),p=!(n&&f.level===n.level),q=n&&f.sn===n.sn+1,r=!p&&q;if(o&&k.logger.log(this.id+":discontinuity detected"),p&&k.logger.log(this.id+":switch detected"),this.frag=f,j)j.postMessage({cmd:"demux",data:b,decryptdata:m,initSegment:c,audioCodec:d,videoCodec:e,timeOffset:l,discontinuity:o,trackSwitch:p,contiguous:r,duration:g,accurateTimeOffset:h,defaultInitPTS:i},[b]);else{var s=this.demuxer;s&&s.push(b,m,c,d,e,l,o,p,r,g,h,i)}}},{key:"onWorkerMessage",value:function(b){var c=b.data,d=this.hls;switch(c.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case f.default.FRAG_PARSING_DATA:c.data.data1=new Uint8Array(c.data1),c.data2&&(c.data.data2=new Uint8Array(c.data2));default:c.data=c.data||{},c.data.frag=this.frag,c.data.id=this.id,d.trigger(c.event,c.data)}}}]),b}();c.default=q},{1:1,17:17,18:18,25:25,27:27,3:3,43:43}],20:[function(a,b,c){"use strict";function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(43),g=function(){function a(b){f(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return d(a,[{key:"loadWord",value:function(){var b=this.data,c=this.bytesAvailable,d=b.byteLength-c,e=new Uint8Array(4),f=Math.min(4,c);if(0===f)throw new Error("no bytes available");e.set(b.subarray(d,d+f)),this.word=new DataView(e.buffer).getUint32(0),this.bitsAvailable=8*f,this.bytesAvailable-=f}},{key:"skipBits",value:function(b){var c;this.bitsAvailable>b?(this.word<<=b,this.bitsAvailable-=b):(b-=this.bitsAvailable,c=b>>3,b-=c>>3,this.bytesAvailable-=c,this.loadWord(),this.word<<=b,this.bitsAvailable-=b)}},{key:"readBits",value:function(b){var c=Math.min(this.bitsAvailable,b),d=this.word>>>32-c;return b>32&&e.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=c,this.bitsAvailable>0?this.word<<=c:this.bytesAvailable>0&&this.loadWord(),c=b-c,c>0&&this.bitsAvailable?d<<c|this.readBits(c):d}},{key:"skipLZ",value:function(){var b;for(b=0;b<this.bitsAvailable;++b)if(0!=(this.word&2147483648>>>b))return this.word<<=b,this.bitsAvailable-=b,b;return this.loadWord(),b+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var b=this.skipLZ();return this.readBits(b+1)-1}},{key:"readEG",value:function(){var b=this.readUEG();return 1&b?1+b>>>1:-1*(b>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(b){var e,f,c=8,d=8;for(e=0;e<b;e++)0!==d&&(f=this.readEG(),d=(c+f+256)%256),c=0===d?c:d}},{key:"readSPS",value:function(){var f,i,j,k,l,m,n,b=0,c=0,d=0,e=0,o=this.readUByte.bind(this),p=this.readBits.bind(this),q=this.readUEG.bind(this),r=this.readBoolean.bind(this),s=this.skipBits.bind(this),t=this.skipEG.bind(this),u=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(o(),f=o(),p(5),s(3),o(),u(),100===f||110===f||122===f||244===f||44===f||83===f||86===f||118===f||128===f){var w=q();if(3===w&&s(1),u(),u(),s(1),r())for(m=3!==w?8:12,n=0;n<m;n++)r()&&v(n<6?16:64)}u();var x=q();if(0===x)q();else if(1===x)for(s(1),t(),t(),i=q(),n=0;n<i;n++)t();u(),s(1),j=q(),k=q(),l=p(1),0===l&&s(1),s(1),r()&&(b=q(),c=q(),d=q(),e=q());var y=[1,1];if(r()&&r()){switch(o()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[o()<<8|o(),o()<<8|o()]}}return{width:Math.ceil(16*(j+1)-2*b-2*c),height:(2-l)*(k+1)*16-(l?2:4)*(d+e),pixelRatio:y}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),a}();c.default=g},{43:43}],21:[function(a,b,c){"use strict";function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(43),g=function(){function a(b){f(this,a),this._hasTimeStamp=!1;for(var d,g,h,i,j,k,l,m,c=0;;)if(l=this.readUTF(b,c,3),c+=3,"ID3"===l)c+=3,d=127&b[c++],g=127&b[c++],h=127&b[c++],i=127&b[c++],j=(d<<21)+(g<<14)+(h<<7)+i,k=c+j,this._parseID3Frames(b,c,k),c=k;else{if("3DI"!==l)return c-=3,void((m=c)&&(this.hasTimeStamp||e.logger.warn("ID3 tag found, but no timestamp"),this._length=m,this._payload=b.subarray(0,m)));c+=7,e.logger.log("3DI footer found, end: "+c)}}return d(a,[{key:"readUTF",value:function(b,c,d){var e="",f=c,g=c+d;do{e+=String.fromCharCode(b[f++])}while(f<g);return e}},{key:"_parseID3Frames",value:function(b,c,d){for(var f,j;c+8<=d;)switch(f=this.readUTF(b,c,4),c+=4,b[c++]<<24+b[c++]<<16+b[c++]<<8+b[c++],b[c++]<<8+b[c++],c,f){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(b,c,44)){c+=44,c+=4;var k=1&b[c++];this._hasTimeStamp=!0,j=((b[c++]<<23)+(b[c++]<<15)+(b[c++]<<7)+b[c++])/45,k&&(j+=47721858.84),j=Math.round(j),e.logger.trace("ID3 timestamp found: "+j),this._timeStamp=j}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),a}();c.default=g},{43:43}],22:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=g(e),i=function(){function a(b,c){h(this,a),this.observer=b,this.remuxer=c}return d(a,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(c,d,e,g){var h=this.initData=a.parseInitSegment(c),i={};h.audio&&(i.audio={container:"audio/mp4",codec:d,initSegment:c}),h.video&&(i.video={container:"video/mp4",codec:e,initSegment:c}),this.observer.trigger(f.default.FRAG_PARSING_INIT_SEGMENT,{tracks:i})}},{key:"append",value:function(c,d,e,f){var g=this.initData,h=a.startDTS(g,c);this.remuxer.remux(g.audio,g.video,null,null,h,e,f,c)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(c){if(c.length>=8){return["moof","ftyp","styp"].indexOf(a.bin2str(c.subarray(4,8)))>=0}return!1}},{key:"bin2str",value:function(b){return String.fromCharCode.apply(null,b)}},{key:"findBox",value:function(c,d){var f,g,h,i,j,e=[];if(!d.length)return null;for(f=0;f<c.byteLength;)g=c[f]<<24,g|=c[f+1]<<16,g|=c[f+2]<<8,g|=c[f+3],h=a.bin2str(c.subarray(f+4,f+8)),i=g>1?f+g:c.byteLength,h===d[0]&&(1===d.length?e.push(c.subarray(f+8,i)):(j=a.findBox(c.subarray(f+8,i),d.slice(1)),j.length&&(e=e.concat(j)))),f=i;return e}},{key:"parseInitSegment",value:function(c){var d=[];return a.findBox(c,["moov","trak"]).forEach(function(b){var c=a.findBox(b,["tkhd"])[0];if(c){var e=c[0],f=0===e?12:20,g=c[f]<<24|c[f+1]<<16|c[f+2]<<8|c[f+3];g=g<0?4294967296+g:g;var h=a.findBox(b,["mdia","mdhd"])[0];if(h){e=h[0],f=0===e?12:20;var i=h[f]<<24|h[f+1]<<16|h[f+2]<<8|h[f+3],j=a.findBox(b,["mdia","hdlr"])[0];if(j){var k=a.bin2str(j.subarray(8,12)),l={soun:"audio",vide:"video"}[k];l&&(d[g]={timescale:i,type:l},d[l]={timescale:i,id:g})}}}}),d}},{key:"startDTS",value:function(c,d){var e,f,g;return e=a.findBox(d,["moof","traf"]),f=[].concat.apply([],e.map(function(b){return a.findBox(b,["tfhd"]).map(function(d){var e,f,g;return e=d[4]<<24|d[5]<<16|d[6]<<8|d[7],f=c[e].timescale||9e4,g=a.findBox(b,["tfdt"]).map(function(a){var b,c;return b=a[0],c=a[4]<<24|a[5]<<16|a[6]<<8|a[7],1===b&&(c*=Math.pow(2,32),c+=a[8]<<24|a[9]<<16|a[10]<<8|a[11]),c})[0],(g=g||1/0)/f})})),g=Math.min.apply(null,f),isFinite(g)?g:0}}]),a}();c.default=i},{27:27}],23:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(13),f=g(e),i=function(){function a(b,c,d,e){h(this,a),this.decryptdata=d,this.discardEPB=e,this.decrypter=new f.default(b,c)}return d(a,[{key:"decryptBuffer",value:function(b,c){this.decrypter.decrypt(b,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,c)}},{key:"decryptAacSample",value:function(b,c,d,e){var f=b[c].unit,g=f.subarray(16,f.length-f.length%16),h=g.buffer.slice(g.byteOffset,g.byteOffset+g.length),i=this;this.decryptBuffer(h,function(a){a=new Uint8Array(a),f.set(a,16),e||i.decryptAacSamples(b,c+1,d)})}},{key:"decryptAacSamples",value:function(b,c,d){for(;;c++){if(c>=b.length)return void d();if(!(b[c].unit.length<32)){var e=this.decrypter.isSync();if(this.decryptAacSample(b,c,d,e),!e)return}}}},{key:"getAvcEncryptedData",value:function(b){for(var c=16*Math.floor((b.length-48)/160)+16,d=new Int8Array(c),e=0,f=32;f<=b.length-16;f+=160,e+=16)d.set(b.subarray(f,f+16),e);return d}},{key:"getAvcDecryptedUnit",value:function(b,c){c=new Uint8Array(c);for(var d=0,e=32;e<=b.length-16;e+=160,d+=16)b.set(c.subarray(d,d+16),e);return b}},{key:"decryptAvcSample",value:function(b,c,d,e,f,g){var h=this.discardEPB(f.data),i=this.getAvcEncryptedData(h),j=this;this.decryptBuffer(i.buffer,function(a){f.data=j.getAvcDecryptedUnit(h,a),g||j.decryptAvcSamples(b,c,d+1,e)})}},{key:"decryptAvcSamples",value:function(b,c,d,e){for(;;c++,d=0){if(c>=b.length)return void e();for(var f=b[c].units;!(d>=f.length);d++){var g=f[d];if(!(g.length<=48||1!==g.type&&5!==g.type)){var h=this.decrypter.isSync();if(this.decryptAvcSample(b,c,d,e,g,h),!h)return}}}}}]),a}();c.default=i},{13:13}],24:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{default:a}}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(16),f=o(e),g=a(27),h=o(g),i=a(20),j=o(i),k=a(23),l=o(k),m=a(43),n=a(25),q=function(){function a(b,c,d,e){p(this,a),this.observer=b,this.config=d,this.typeSupported=e,this.remuxer=c,this.sampleAes=null}return d(a,[{key:"setDecryptData",value:function(b){null!=b&&null!=b.key&&"SAMPLE-AES"===b.method?this.sampleAes=new l.default(this.observer,this.config,b,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(b,c,d,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=e}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(b,c,d,e){var f,i,j,l,o,g=b.length,p=!1;this.contiguous=d;var q=this.pmtParsed,r=this._avcTrack,s=this._audioTrack,t=this._id3Track,u=r.id,v=s.id,w=t.id,x=this._pmtId,y=r.pesData,z=s.pesData,A=t.pesData,B=this._parsePAT,C=this._parsePMT,D=this._parsePES,E=this._parseAVCPES.bind(this),F=this._parseAACPES.bind(this),G=this._parseMPEGPES.bind(this),H=this._parseID3PES.bind(this);for(g-=g%188,f=0;f<g;f+=188)if(71===b[f]){if(i=!!(64&b[f+1]),j=((31&b[f+1])<<8)+b[f+2],(48&b[f+3])>>4>1){if((l=f+5+b[f+4])===f+188)continue}else l=f+4;switch(j){case u:i&&(y&&(o=D(y))&&E(o,!1),y={data:[],size:0}),y&&(y.data.push(b.subarray(l,f+188)),y.size+=f+188-l);break;case v:i&&(z&&(o=D(z))&&(s.isAAC?F(o):G(o)),z={data:[],size:0}),z&&(z.data.push(b.subarray(l,f+188)),z.size+=f+188-l);break;case w:i&&(A&&(o=D(A))&&H(o),A={data:[],size:0}),A&&(A.data.push(b.subarray(l,f+188)),A.size+=f+188-l);break;case 0:i&&(l+=b[l]+1),x=this._pmtId=B(b,l);break;case x:i&&(l+=b[l]+1);var I=C(b,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);u=I.avc,u>0&&(r.id=u),v=I.audio,v>0&&(s.id=v,s.isAAC=I.isAAC),w=I.id3,w>0&&(t.id=w),p&&!q&&(m.logger.log("reparse from beginning"),p=!1,f=-188),q=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(h.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});y&&(o=D(y))?(E(o,!0),r.pesData=null):r.pesData=y,z&&(o=D(z))?(s.isAAC?F(o):G(o),s.pesData=null):(z&&z.size&&m.logger.log("last AAC PES packet truncated,might overlap between fragments"),s.pesData=z),A&&(o=D(A))?(H(o),t.pesData=null):t.pesData=A,null==this.sampleAes?this.remuxer.remux(s,r,t,this._txtTrack,c,d,e):this.decryptAndRemux(s,r,t,this._txtTrack,c,d,e)}},{key:"decryptAndRemux",value:function(b,c,d,e,f,g,h){if(b.samples&&b.isAAC){var i=this;this.sampleAes.decryptAacSamples(b.samples,0,function(){i.decryptAndRemuxAvc(b,c,d,e,f,g,h)})}else this.decryptAndRemuxAvc(b,c,d,e,f,g,h)}},{key:"decryptAndRemuxAvc",value:function(b,c,d,e,f,g,h){if(c.samples){var i=this;this.sampleAes.decryptAvcSamples(c.samples,0,0,function(){i.remuxer.remux(b,c,d,e,f,g,h)})}else this.remuxer.remux(b,c,d,e,f,g,h)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(b,c){return(31&b[c+10])<<8|b[c+11]}},{key:"_parsePMT",value:function(b,c,d,e){var f,g,h,i,j={audio:-1,avc:-1,id3:-1,isAAC:!0};for(f=(15&b[c+1])<<8|b[c+2],g=c+3+f-4,h=(15&b[c+10])<<8|b[c+11],c+=12+h;c<g;){switch(i=(31&b[c+1])<<8|b[c+2],b[c]){case 207:if(!e){m.logger.log("unkown stream type:"+b[c]);break}case 15:-1===j.audio&&(j.audio=i);break;case 21:-1===j.id3&&(j.id3=i);break;case 219:if(!e){m.logger.log("unkown stream type:"+b[c]);break}case 27:-1===j.avc&&(j.avc=i);break;case 3:case 4:d?-1===j.audio&&(j.audio=i,j.isAAC=!1):m.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:m.logger.warn("HEVC stream type found, not supported for now");break;default:m.logger.log("unkown stream type:"+b[c])}c+=5+((15&b[c+3])<<8|b[c+4])}return j}},{key:"_parsePES",value:function(b){var d,e,g,h,i,j,k,l,c=0,n=b.data;if(!b||0===b.size)return null;for(;n[0].length<19&&n.length>1;){var o=new Uint8Array(n[0].length+n[1].length);o.set(n[0]),o.set(n[1],n[0].length),n[0]=o,n.splice(1,1)}if(d=n[0],1===(d[0]<<16)+(d[1]<<8)+d[2]){if((g=(d[4]<<8)+d[5])&&g>b.size-6)return null;e=d[7],192&e&&(j=536870912*(14&d[9])+4194304*(255&d[10])+16384*(254&d[11])+128*(255&d[12])+(254&d[13])/2,j>4294967295&&(j-=8589934592),64&e?(k=536870912*(14&d[14])+4194304*(255&d[15])+16384*(254&d[16])+128*(255&d[17])+(254&d[18])/2,k>4294967295&&(k-=8589934592),j-k>54e5&&(m.logger.warn(Math.round((j-k)/9e4)+"s delta between PTS and DTS, align them"),j=k)):k=j),h=d[8],l=h+9,b.size-=l,i=new Uint8Array(b.size);for(var p=0,q=n.length;p<q;p++){d=n[p];var r=d.byteLength;if(l){if(l>r){l-=r;continue}d=d.subarray(l),r-=l,l=0}i.set(d,c),c+=r}return g&&(g-=h+3),{data:i,pts:j,dts:k,len:g}}return null}},{key:"pushAccesUnit",value:function(b,c){if(b.units.length&&b.frame){var d=c.samples,e=d.length;!this.config.forceKeyFrameOnDiscontinuity||!0===b.key||c.sps&&(e||this.contiguous)?(b.id=e,d.push(b)):c.dropped++}b.debug.length&&m.logger.log(b.pts+"/"+b.dts+":"+b.debug)}},{key:"_parseAVCPES",value:function(b,c){var h,k,l,d=this,e=this._avcTrack,f=this._parseAVCNALu(b.data),g=!1,i=this.avcSample;b.data=null,f.forEach(function(a){switch(a.type){case 1:k=!0,g&&i&&(i.debug+="NDR "),i.frame=!0;var c=a.data;if(c.length>4){var f=new j.default(c).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(i.key=!0)}break;case 5:k=!0,i||(i=d.avcSample=d._createAVCSample(!0,b.pts,b.dts,"")),g&&(i.debug+="IDR "),i.key=!0,i.frame=!0;break;case 6:k=!0,g&&i&&(i.debug+="SEI "),h=new j.default(d.discardEPB(a.data)),h.readUByte();for(var m=0,n=0,o=!1,p=0;!o&&h.bytesAvailable>1;){m=0;do{p=h.readUByte(),m+=p}while(255===p);n=0;do{p=h.readUByte(),n+=p}while(255===p);if(4===m&&0!==h.bytesAvailable){o=!0;if(181===h.readUByte()){if(49===h.readUShort()){if(1195456820===h.readUInt()){if(3===h.readUByte()){var u=h.readUByte(),v=h.readUByte(),w=31&u,x=[u,v];for(l=0;l<w;l++)x.push(h.readUByte()),x.push(h.readUByte()),x.push(h.readUByte());d._insertSampleInOrder(d._txtTrack.samples,{type:3,pts:b.pts,bytes:x})}}}}}else if(n<h.bytesAvailable)for(l=0;l<n;l++)h.readUByte()}break;case 7:if(k=!0,g&&i&&(i.debug+="SPS "),!e.sps){h=new j.default(a.data);var y=h.readSPS();e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[a.data],e.duration=d._duration;var z=a.data.subarray(1,4),A="avc1.";for(l=0;l<3;l++){var B=z[l].toString(16);B.length<2&&(B="0"+B),A+=B}e.codec=A}break;case 8:k=!0,g&&i&&(i.debug+="PPS "),e.pps||(e.pps=[a.data]);break;case 9:k=!1,i&&d.pushAccesUnit(i,e),i=d.avcSample=d._createAVCSample(!1,b.pts,b.dts,g?"AUD ":"");break;case 12:k=!1;break;default:k=!1,i&&(i.debug+="unknown NAL "+a.type+" ")}if(i&&k){i.units.push(a)}}),c&&i&&(this.pushAccesUnit(i,e),this.avcSample=null)}},{key:"_createAVCSample",value:function(b,c,d,e){return{key:b,pts:c,dts:d,units:[],debug:e}}},{key:"_insertSampleInOrder",value:function(b,c){var d=b.length;if(d>0){if(c.pts>=b[d-1].pts)b.push(c);else for(var e=d-1;e>=0;e--)if(c.pts<b[e].pts){b.splice(e,0,c);break}}else b.push(c)}},{key:"_getLastNalUnit",value:function(){var b=this.avcSample,c=void 0;if(!b||0===b.units.length){var d=this._avcTrack,e=d.samples;b=e[e.length-1]}if(b){var f=b.units;c=f[f.length-1]}return c}},{key:"_parseAVCNALu",value:function(b){var e,f,k,l,n,c=0,d=b.byteLength,g=this._avcTrack,h=g.naluState||0,i=h,j=[],m=-1;for(-1===h&&(m=0,n=31&b[0],h=0,c=1);c<d;)if(e=b[c++],h)if(1!==h)if(e)if(1===e){if(m>=0)k={data:b.subarray(m,c-h-1),type:n},j.push(k);else{var o=this._getLastNalUnit();if(o&&(i&&c<=4-i&&o.state&&(o.data=o.data.subarray(0,o.data.byteLength-i)),(f=c-h-1)>0)){var p=new Uint8Array(o.data.byteLength+f);p.set(o.data,0),p.set(b.subarray(0,f),o.data.byteLength),o.data=p}}c<d?(l=31&b[c],m=c,n=l,h=0):h=-1}else h=0;else h=3;else h=e?0:2;else h=e?0:1;if(m>=0&&h>=0&&(k={data:b.subarray(m,d),type:n,state:h},j.push(k)),0===j.length){var q=this._getLastNalUnit();if(q){var r=new Uint8Array(q.data.byteLength+b.byteLength);r.set(q.data,0),r.set(b,q.data.byteLength),q.data=r}}return g.naluState=h,j}},{key:"discardEPB",value:function(b){for(var f,g,c=b.byteLength,d=[],e=1;e<c-2;)0===b[e]&&0===b[e+1]&&3===b[e+2]?(d.push(e+2),e+=2):e++;if(0===d.length)return b;f=c-d.length,g=new Uint8Array(f);var h=0;for(e=0;e<f;h++,e++)h===d[0]&&(h++,d.shift()),g[e]=b[h];return g}},{key:"_parseAACPES",value:function(b){var k,l,o,p,q,r,s,t,u,c=this._audioTrack,d=b.data,e=b.pts,g=0,i=this.aacOverFlow,j=this.aacLastPTS;if(i){var v=new Uint8Array(i.byteLength+d.byteLength);v.set(i,0),v.set(d,i.byteLength),d=v}for(q=g,t=d.length;q<t-1&&(255!==d[q]||240!=(240&d[q+1]));q++);if(q){var w,x;if(q<t-1?(w="AAC PES did not start with ADTS header,offset:"+q,x=!1):(w="no ADTS header found in AAC PES",x=!0),m.logger.warn("parsing error:"+w),this.observer.trigger(h.default.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:x,reason:w}),x)return}if(!c.samplerate){var y=this.audioCodec;k=f.default.getAudioConfig(this.observer,d,q,y),c.config=k.config,c.samplerate=k.samplerate,c.channelCount=k.channelCount,c.codec=k.codec,c.manifestCodec=k.manifestCodec,c.duration=this._duration,m.logger.log("parsed codec:"+c.codec+",rate:"+k.samplerate+",nb channel:"+k.channelCount)}if(p=0,o=9216e4/c.samplerate,i&&j){var z=j+o;Math.abs(z-e)>1&&(m.logger.log("AAC: align PTS for overlapping frames by "+Math.round((z-e)/90)),e=z)}for(;q+5<t&&(r=1&d[q+1]?7:9,l=(3&d[q+3])<<11|d[q+4]<<3|(224&d[q+5])>>>5,(l-=r)>0&&q+r+l<=t);)for(s=e+p*o,u={unit:d.subarray(q+r,q+r+l),pts:s,dts:s},c.samples.push(u),c.len+=l,q+=l+r,p++;q<t-1&&(255!==d[q]||240!=(240&d[q+1]));q++);i=q<t?d.subarray(q,t):null,this.aacOverFlow=i,this.aacLastPTS=s}},{key:"_parseMPEGPES",value:function(b){for(var h,c=b.data,d=b.pts,e=c.length,f=0,g=0;g<e&&(h=this._parseMpeg(c,g,e,f++,d))>0;)g+=h}},{key:"_onMpegFrame",value:function(b,c,d,e,f,g){var h=1152/d*1e3,i=g+f*h,j=this._audioTrack;j.config=[],j.channelCount=e,j.samplerate=d,j.duration=this._duration,j.samples.push({unit:b,pts:i,dts:i}),j.len+=b.length}},{key:"_onMpegNoise",value:function(b){m.logger.warn("mpeg audio has noise: "+b.length+" bytes")}},{key:"_parseMpeg",value:function(b,c,d,e,f){var g=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],h=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(c+2>d)return-1;if(255===b[c]||224==(224&b[c+1])){if(c+24>d)return-1;var i=b[c+1]>>3&3,j=b[c+1]>>1&3,k=b[c+2]>>4&15,l=b[c+2]>>2&3,m=!!(2&b[c+2]);if(1!==i&&0!==k&&15!==k&&3!==l){var n=3===i?3-j:3===j?3:4,o=1e3*g[14*n+k-1],p=3===i?0:2===i?1:2,q=h[3*p+l],r=m?1:0,s=b[c+3]>>6==3?1:2,t=3===j?(3===i?12:6)*o/q+r<<2:(3===i?144:72)*o/q+r|0;return c+t>d?-1:(this._onMpegFrame&&this._onMpegFrame(b.subarray(c,c+t),o,q,s,e,f),t)}}for(var u=c+2;u<d;){if(255===b[u-1]&&224==(224&b[u]))return this._onMpegNoise&&this._onMpegNoise(b.subarray(c,u-1)),u-c-1;u++}return-1}},{key:"_parseID3PES",value:function(b){this._id3Track.samples.push(b)}}],[{key:"probe",value:function(b){return b.length>=564&&71===b[0]&&71===b[188]&&71===b[376]}}]),a}();c.default=q},{16:16,20:20,23:23,25:25,27:27,43:43}],25:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},c.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],26:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(43),g=a(25),h=a(27),i=j(h),l=function(){function a(b){k(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];this.handledEvents=d,this.useGenericHandler=!0,this.registerListeners()}return e(a,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===d(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(b,c){this.onEventGeneric(b,c)}},{key:"onEventGeneric",value:function(b,c){var d=function(b,c){var d="on"+b.replace("hls","");if("function"!=typeof this[d])throw new Error("Event "+b+" has no generic handler in this "+this.constructor.name+" class (tried "+d+")");return this[d].bind(this,c)};try{d.call(this,b,c).call()}catch(a){f.logger.error("internal error happened while processing "+b+":"+a.message),this.hls.trigger(i.default.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:b,err:a})}}}]),a}();c.default=l},{25:25,27:27,43:43}],27:[function(a,b,c){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],28:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){e(this,a)}return d(a,null,[{key:"getSilentFrame",value:function(b,c){switch(b){case"mp4a.40.2":if(1===c)return new Uint8Array([0,200,0,128,35,128]);if(2===c)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===c)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===c)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===c)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===c)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===c)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===c)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===c)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a}();c.default=f},{}],29:[function(a,b,c){"use strict";var d={isBuffered:function(b,c){if(b)for(var d=b.buffered,e=0;e<d.length;e++)if(c>=d.start(e)&&c<=d.end(e))return!0;return!1},bufferInfo:function(b,c,d){if(b){var g,e=b.buffered,f=[];for(g=0;g<e.length;g++)f.push({start:e.start(g),end:e.end(g)});return this.bufferedInfo(f,c,d)}return{len:0,start:c,end:c,nextStart:void 0}},bufferedInfo:function(b,c,d){var f,g,h,i,j,e=[];for(b.sort(function(a,b){var c=a.start-b.start;return c||b.end-a.end}),j=0;j<b.length;j++){var k=e.length;if(k){var l=e[k-1].end;b[j].start-l<d?b[j].end>l&&(e[k-1].end=b[j].end):e.push(b[j])}else e.push(b[j])}for(j=0,f=0,g=h=c;j<e.length;j++){var m=e[j].start,n=e[j].end;if(c+d>=m&&c<n)g=m,h=n,f=h-c;else if(c+d<m){i=m;break}}return{len:f,start:g,end:h,nextStart:i}}};b.exports=d},{}],30:[function(a,b,c){"use strict";var d=a(43),e={mergeDetails:function(b,c){var l,f=Math.max(b.startSN,c.startSN)-c.startSN,g=Math.min(b.endSN,c.endSN)-c.startSN,h=c.startSN-b.startSN,i=b.fragments,j=c.fragments,k=0;if(g<f)return void(c.PTSKnown=!1);for(var m=f;m<=g;m++){var n=i[h+m],o=j[m];o&&n&&(k=n.cc-o.cc,isNaN(n.startPTS)||(o.start=o.startPTS=n.startPTS,o.endPTS=n.endPTS,o.duration=n.duration,l=o))}if(k)for(d.logger.log("discontinuity sliding from playlist, take drift into account"),m=0;m<j.length;m++)j[m].cc+=k;if(l)e.updateFragPTSDTS(c,l.sn,l.startPTS,l.endPTS,l.startDTS,l.endDTS);else if(h>=0&&h<i.length){var p=i[h].start;for(m=0;m<j.length;m++)j[m].start+=p}c.PTSKnown=b.PTSKnown},updateFragPTSDTS:function(b,c,d,f,g,h){var i,j,k,l;if(!b||c<b.startSN||c>b.endSN)return 0;if(i=c-b.startSN,j=b.fragments,k=j[i],!isNaN(k.startPTS)){var m=Math.abs(k.startPTS-d);isNaN(k.deltaPTS)?k.deltaPTS=m:k.deltaPTS=Math.max(m,k.deltaPTS),d=Math.min(d,k.startPTS),f=Math.max(f,k.endPTS),g=Math.min(g,k.startDTS),h=Math.max(h,k.endDTS)}var n=d-k.start;for(k.start=k.startPTS=d,k.endPTS=f,k.startDTS=g,k.endDTS=h,k.duration=f-d,l=i;l>0;l--)e.updatePTS(j,l,l-1);for(l=i;l<j.length-1;l++)e.updatePTS(j,l,l+1);return b.PTSKnown=!0,n},updatePTS:function(b,c,e){var f=b[c],g=b[e],h=g.startPTS;isNaN(h)?g.start=e>c?f.start+f.duration:f.start-g.duration:e>c?(f.duration=h-f.start,f.duration<0&&d.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!")):(g.duration=f.start-h,g.duration<0&&d.logger.warn("negative duration computed for frag "+g.sn+",level "+g.level+", there should be some duration drift between playlist and fragment!"))}};b.exports=e},{43:43}],31:[function(a,b,c){"use strict";function x(a){return a&&a.__esModule?a:{default:a}}function y(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(2),f=x(e),g=a(27),h=x(g),i=a(25),j=a(35),k=x(j),l=a(33),m=x(l),n=a(34),o=x(n),p=a(10),q=x(p),r=a(9),s=x(r),t=a(43),u=a(1),v=x(u),w=a(4),z=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,a);var d=a.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var e in d)e in c||(c[e]=d[e]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,t.enableLogs)(c.debug),this.config=c,this._autoLevelCapping=-1;var f=this.observer=new v.default;f.trigger=function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];f.emit.apply(f,[b,b].concat(d))},f.off=function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];f.removeListener.apply(f,[b].concat(d))},this.on=f.on.bind(f),this.once=f.once.bind(f),this.off=f.off.bind(f),this.trigger=f.trigger.bind(f);var g=this.abrController=new c.abrController(this),h=new c.bufferController(this),i=new c.capLevelController(this),j=new c.fpsController(this),l=new k.default(this),n=new m.default(this),p=new o.default(this),r=this.levelController=new s.default(this),u=this.streamController=new q.default(this),w=[r,u],x=c.audioStreamController;x&&w.push(new x(this)),this.networkControllers=w;var z=[l,n,p,g,h,i,j];if(x=c.audioTrackController){var A=new x(this);this.audioTrackController=A,z.push(A)}if(x=c.subtitleTrackController){var B=new x(this);this.subtitleTrackController=B,z.push(B)}[c.subtitleStreamController,c.timelineController].forEach(function(a){a&&z.push(new a(b))}),this.coreComponents=z}return d(a,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.7.5"}},{key:"Events",get:function(){return h.default}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:w.hlsDefaultConfig},set:function(c){a.defaultConfig=c}}]),d(a,[{key:"destroy",value:function(){t.logger.log("destroy"),this.trigger(h.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(b){t.logger.log("attachMedia"),this.media=b,this.trigger(h.default.MEDIA_ATTACHING,{media:b})}},{key:"detachMedia",value:function(){t.logger.log("detachMedia"),this.trigger(h.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(b){b=f.default.buildAbsoluteURL(window.location.href,b,{alwaysNormalize:!0}),t.logger.log("loadSource:"+b),this.url=b,this.trigger(h.default.MANIFEST_LOADING,{url:b})}},{key:"startLoad",value:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;t.logger.log("startLoad("+b+")"),this.networkControllers.forEach(function(a){a.startLoad(b)})}},{key:"stopLoad",value:function(){t.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})}},{key:"swapAudioCodec",value:function(){t.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){t.logger.log("recoverMediaError");var b=this.media;this.detachMedia(),this.attachMedia(b)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(b){t.logger.log("set currentLevel:"+b),this.loadLevel=b,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(b){t.logger.log("set nextLevel:"+b),this.levelController.manualLevel=b,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(b){t.logger.log("set loadLevel:"+b),this.levelController.manualLevel=b}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(b){this.levelController.nextLoadLevel=b}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(b){t.logger.log("set firstLevel:"+b),this.levelController.firstLevel=b}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(b){t.logger.log("set startLevel:"+b);var c=this;-1!==b&&(b=Math.max(b,c.minAutoLevel)),c.levelController.startLevel=b}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(b){t.logger.log("set autoLevelCapping:"+b),this._autoLevelCapping=b}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var b=this,c=b.levels,d=b.config.minAutoBitrate,e=c?c.length:0,f=0;f<e;f++){if((c[f].realBitrate?Math.max(c[f].realBitrate,c[f].bitrate):c[f].bitrate)>d)return f}return 0}},{key:"maxAutoLevel",get:function(){var b=this,c=b.levels,d=b.autoLevelCapping;return-1===d&&c&&c.length?c.length-1:d}},{key:"nextAutoLevel",get:function(){var b=this;return Math.min(Math.max(b.abrController.nextAutoLevel,b.minAutoLevel),b.maxAutoLevel)},set:function(b){var c=this;c.abrController.nextAutoLevel=Math.max(c.minAutoLevel,b)}},{key:"audioTracks",get:function(){var b=this.audioTrackController;return b?b.audioTracks:[]}},{key:"audioTrack",get:function(){var b=this.audioTrackController;return b?b.audioTrack:-1},set:function(b){var c=this.audioTrackController;c&&(c.audioTrack=b)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var b=this.subtitleTrackController;return b?b.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var b=this.subtitleTrackController;return b?b.subtitleTrack:-1},set:function(b){var c=this.subtitleTrackController;c&&(c.subtitleTrack=b)}}]),a}();c.default=z},{1:1,10:10,2:2,25:25,27:27,33:33,34:34,35:35,4:4,43:43,9:9}],32:[function(a,b,c){"use strict";b.exports=a(31).default},{31:31}],33:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{default:a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=k(e),g=a(26),h=k(g),i=a(25),j=a(43),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.FRAG_LOADING));return c.loaders={},c}return n(b,a),d(b,[{key:"destroy",value:function(){var b=this.loaders;for(var c in b){var d=b[c];d&&d.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(b){var c=b.frag,d=c.type,e=this.loaders[d],f=this.hls.config;c.loaded=0,e&&(j.logger.warn("abort previous fragment loader for type:"+d),e.abort()),e=this.loaders[d]=c.loader=void 0!==f.fLoader?new f.fLoader(f):new f.loader(f);var g=void 0,h=void 0,i=void 0;g={url:c.url,frag:c,responseType:"arraybuffer",progressData:!1};var k=c.byteRangeStartOffset,l=c.byteRangeEndOffset;isNaN(k)||isNaN(l)||(g.rangeStart=k,g.rangeEnd=l),h={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},e.load(g,h,i)}},{key:"loadsuccess",value:function(b,c,d){var e=b.data,g=d.frag;g.loader=void 0,this.loaders[g.type]=void 0,this.hls.trigger(f.default.FRAG_LOADED,{payload:e,frag:g,stats:c})}},{key:"loaderror",value:function(b,c){var d=c.loader;d&&d.abort(),this.loaders[c.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c.frag,response:b})}},{key:"loadtimeout",value:function(b,c){var d=c.loader;d&&d.abort(),this.loaders[c.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c.frag})}},{key:"loadprogress",value:function(b,c,d){var e=c.frag;e.loaded=b.loaded,this.hls.trigger(f.default.FRAG_LOAD_PROGRESS,{frag:e,stats:b})}}]),b}(h.default);c.default=o},{25:25,26:26,27:27,43:43}],34:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{default:a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=k(e),g=a(26),h=k(g),i=a(25),j=a(43),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.KEY_LOADING));return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return n(b,a),d(b,[{key:"destroy",value:function(){for(var b in this.loaders){var c=this.loaders[b];c&&c.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(b){var c=b.frag,d=c.type,e=this.loaders[d],g=c.decryptdata,h=g.uri;if(h!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;e&&(j.logger.warn("abort previous key loader for type:"+d),e.abort()),c.loader=this.loaders[d]=new i.loader(i),this.decrypturl=h,this.decryptkey=null;var k=void 0,l=void 0,m=void 0;k={url:h,frag:c,responseType:"arraybuffer"},l={timeout:i.fragLoadingTimeOut,maxRetry:i.fragLoadingMaxRetry,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.loader.load(k,l,m)}else this.decryptkey&&(g.key=this.decryptkey,this.hls.trigger(f.default.KEY_LOADED,{frag:c}))}},{key:"loadsuccess",value:function(b,c,d){var e=d.frag;this.decryptkey=e.decryptdata.key=new Uint8Array(b.data),e.loader=void 0,this.loaders[e.type]=void 0,this.hls.trigger(f.default.KEY_LOADED,{frag:e})}},{key:"loaderror",value:function(b,c){var d=c.frag,e=d.loader;e&&e.abort(),this.loaders[c.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:d,response:b})}},{key:"loadtimeout",value:function(b,c){var d=c.frag,e=d.loader;e&&e.abort(),this.loaders[c.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:d})}}]),b}(h.default);c.default=o},{25:25,26:26,27:27,43:43}],35:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{default:a}}function p(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(2),f=o(e),g=a(27),h=o(g),i=a(26),j=o(i),k=a(25),l=a(39),m=o(l),n=a(43),s=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,t=/#EXT-X-MEDIA:(.*)/g,u=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,v=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,w=function(){function a(){r(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return d(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=f.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),a}(),x=function(){function a(){r(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return d(a,[{key:"createInitializationVector",value:function(b){for(var c=new Uint8Array(16),d=12;d<16;d++)c[d]=b>>8*(15-d)&255;return c}},{key:"fragmentDecryptdataFromLevelkey",value:function(b,c){var d=b;return b&&b.method&&b.uri&&!b.iv&&(d=new w,d.method=b.method,d.baseuri=b.baseuri,d.reluri=b.reluri,d.iv=this.createInitializationVector(c)),d}},{key:"cloneObj",value:function(b){return JSON.parse(JSON.stringify(b))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=f.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(b){this._url=b}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var b=this._byteRange=[];if(this.rawByteRange){var c=this.rawByteRange.split("@",2);if(1===c.length){var d=this.lastByteRangeEndOffset;b[0]=d||0}else b[0]=parseInt(c[1]);b[1]=parseInt(c[0])+b[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),y=function(a){function b(a){r(this,b);var c=p(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,h.default.MANIFEST_LOADING,h.default.LEVEL_LOADING,h.default.AUDIO_TRACK_LOADING,h.default.SUBTITLE_TRACK_LOADING));return c.loaders={},c}return q(b,a),d(b,[{key:"destroy",value:function(){for(var b in this.loaders){var c=this.loaders[b];c&&c.destroy()}this.loaders={},j.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(b){this.load(b.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(b){this.load(b.url,{type:"level",level:b.level,id:b.id})}},{key:"onAudioTrackLoading",value:function(b){this.load(b.url,{type:"audioTrack",id:b.id})}},{key:"onSubtitleTrackLoading",value:function(b){this.load(b.url,{type:"subtitleTrack",id:b.id})}},{key:"load",value:function(b,c){var d=this.loaders[c.type];if(d){var e=d.context;if(e&&e.url===b)return void n.logger.trace("playlist request ongoing");n.logger.warn("abort previous loader for type:"+c.type),d.abort()}var f=this.hls.config,g=void 0,h=void 0,i=void 0,j=void 0;"manifest"===c.type?(g=f.manifestLoadingMaxRetry,h=f.manifestLoadingTimeOut,i=f.manifestLoadingRetryDelay,j=f.manifestLoadingMaxRetryTimeout):(g=f.levelLoadingMaxRetry,h=f.levelLoadingTimeOut,i=f.levelLoadingRetryDelay,j=f.levelLoadingMaxRetryTimeout,n.logger.log("loading playlist for "+c.type+" "+(c.level||c.id))),d=this.loaders[c.type]=c.loader=void 0!==f.pLoader?new f.pLoader(f):new f.loader(f),c.url=b,c.responseType="";var k=void 0,l=void 0;k={timeout:h,maxRetry:g,retryDelay:i,maxRetryDelay:j},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},d.load(c,k,l)}},{key:"resolve",value:function(b,c){return f.default.buildAbsoluteURL(c,b,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(b,c){var d=[],e=void 0;for(s.lastIndex=0;null!=(e=s.exec(b));){var f={},g=f.attrs=new m.default(e[1]);f.url=this.resolve(e[2],c);var h=g.decimalResolution("RESOLUTION");h&&(f.width=h.width,f.height=h.height),f.bitrate=g.decimalInteger("AVERAGE-BANDWIDTH")||g.decimalInteger("BANDWIDTH"),f.name=g.NAME;var i=g.CODECS;if(i){i=i.split(/[ ,]+/);for(var j=0;j<i.length;j++){var k=i[j];-1!==k.indexOf("avc1")?f.videoCodec=this.avc1toavcoti(k):f.audioCodec=k}}d.push(f)}return d}},{key:"parseMasterPlaylistMedia",value:function(b,c,d){var e=void 0,f=[],g=0;for(t.lastIndex=0;null!=(e=t.exec(b));){var h={},i=new m.default(e[1]);i.TYPE===d&&(h.groupId=i["GROUP-ID"],h.name=i.NAME,h.type=d,h.default="YES"===i.DEFAULT,h.autoselect="YES"===i.AUTOSELECT,h.forced="YES"===i.FORCED,i.URI&&(h.url=this.resolve(i.URI,c)),h.lang=i.LANGUAGE,h.name||(h.name=h.lang),h.id=g++,f.push(h))}return f}},{key:"avc1toavcoti",value:function(b){var c,d=b.split(".");return d.length>2?(c=d.shift()+".",c+=parseInt(d.shift()).toString(16),c+=("000"+parseInt(d.shift()).toString(16)).substr(-4)):c=b,c}},{key:"parseLevelPlaylist",value:function(b,c,d,e){var o,p,f=0,g=0,h={type:null,version:null,url:c,fragments:[],live:!0,startSN:0},i=new w,j=0,k=null,l=new x;for(u.lastIndex=0;null!==(o=u.exec(b));){var q=o[1];if(q){l.duration=parseFloat(q);var r=(" "+o[2]).slice(1);l.title=r||null,l.tagList.push(r?["INF",q,r]:["INF",q])}else if(o[3]){if(!isNaN(l.duration)){var s=f++;l.type=e,l.start=g,l.levelkey=i,l.sn=s,l.level=d,l.cc=j,l.baseurl=c,l.relurl=(" "+o[3]).slice(1),h.fragments.push(l),k=l,g+=l.duration,l=new x}}else if(o[4]){if(l.rawByteRange=(" "+o[4]).slice(1),k){var t=k.byteRangeEndOffset;t&&(l.lastByteRangeEndOffset=t)}}else if(o[5])l.rawProgramDateTime=(" "+o[5]).slice(1),l.tagList.push(["PROGRAM-DATE-TIME",l.rawProgramDateTime]);else{for(o=o[0].match(v),p=1;p<o.length&&void 0===o[p];p++);var y=(" "+o[p+1]).slice(1),z=(" "+o[p+2]).slice(1);switch(o[p]){case"#":l.tagList.push(z?[y,z]:[y]);break;case"PLAYLIST-TYPE":h.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":f=h.startSN=parseInt(y);break;case"TARGETDURATION":h.targetduration=parseFloat(y);break;case"VERSION":h.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":j++,l.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":j=parseInt(y);break;case"KEY":var A=y,B=new m.default(A),C=B.enumeratedString("METHOD"),D=B.URI,E=B.hexadecimalInteger("IV");C&&(i=new w,D&&["AES-128","SAMPLE-AES"].indexOf(C)>=0&&(i.method=C,i.baseuri=c,i.reluri=D,i.key=null,i.iv=E));break;case"START":var F=y,G=new m.default(F),H=G.decimalFloatingPoint("TIME-OFFSET");isNaN(H)||(h.startTimeOffset=H);break;case"MAP":var I=new m.default(y);l.relurl=I.URI,l.rawByteRange=I.BYTERANGE,l.baseurl=c,l.level=d,l.type=e,l.sn="initSegment",h.initSegment=l,l=new x;break;default:n.logger.warn("line parsed but not handled: "+o)}}}return l=k,l&&!l.relurl&&(h.fragments.pop(),g-=l.duration),h.totalduration=g,h.averagetargetduration=g/h.fragments.length,h.endSN=f-1,h}},{key:"loadsuccess",value:function(b,c,d){var e=b.data,f=b.url,g=d.type,i=d.id,j=d.level,l=this.hls;if(this.loaders[g]=void 0,void 0!==f&&0!==f.indexOf("data:")||(f=d.url),c.tload=performance.now(),0===e.indexOf("#EXTM3U"))if(e.indexOf("#EXTINF:")>0){var m="audioTrack"!==g&&"subtitleTrack"!==g,o=isNaN(j)?isNaN(i)?0:i:j,p=this.parseLevelPlaylist(e,f,o,"audioTrack"===g?"audio":"subtitleTrack"===g?"subtitle":"main");p.tload=c.tload,"manifest"===g&&l.trigger(h.default.MANIFEST_LOADED,{levels:[{url:f,details:p}],audioTracks:[],url:f,stats:c}),c.tparsed=performance.now(),p.targetduration?m?l.trigger(h.default.LEVEL_LOADED,{details:p,level:j||0,id:i||0,stats:c}):"audioTrack"===g?l.trigger(h.default.AUDIO_TRACK_LOADED,{details:p,id:i,stats:c}):"subtitleTrack"===g&&l.trigger(h.default.SUBTITLE_TRACK_LOADED,{details:p,id:i,stats:c}):l.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"invalid targetduration"})}else{var q=this.parseMasterPlaylist(e,f);if(q.length){var r=this.parseMasterPlaylistMedia(e,f,"AUDIO"),s=this.parseMasterPlaylistMedia(e,f,"SUBTITLES");if(r.length){var t=!1;r.forEach(function(a){a.url||(t=!0)}),!1===t&&q[0].audioCodec&&!q[0].attrs.AUDIO&&(n.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),r.unshift({type:"main",name:"main"}))}l.trigger(h.default.MANIFEST_LOADED,{levels:q,audioTracks:r,subtitles:s,url:f,stats:c})}else l.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no level found in manifest"})}else l.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(b,c){var d,e,f=c.loader;switch(c.type){case"manifest":d=k.ErrorDetails.MANIFEST_LOAD_ERROR,e=!0;break;case"level":d=k.ErrorDetails.LEVEL_LOAD_ERROR,e=!1;break;case"audioTrack":d=k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,e=!1}f&&(f.abort(),this.loaders[c.type]=void 0),this.hls.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:d,fatal:e,url:f.url,loader:f,response:b,context:c})}},{key:"loadtimeout",value:function(b,c){var d,e,f=c.loader;switch(c.type){case"manifest":d=k.ErrorDetails.MANIFEST_LOAD_TIMEOUT,e=!0;break;case"level":d=k.ErrorDetails.LEVEL_LOAD_TIMEOUT,e=!1;break;case"audioTrack":d=k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,e=!1}f&&(f.abort(),this.loaders[c.type]=void 0),this.hls.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:d,fatal:e,url:f.url,loader:f,context:c})}}]),b}(j.default);c.default=y},{2:2,25:25,26:26,27:27,39:39,43:43}],36:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=Math.pow(2,32)-1,g=function(){function a(){e(this,a)}return d(a,null,[{key:"init",value:function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var c;for(c in a.types)a.types.hasOwnProperty(c)&&(a.types[c]=[c.charCodeAt(0),c.charCodeAt(1),c.charCodeAt(2),c.charCodeAt(3)]);var d=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:d,audio:e};var f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),g=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=g,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]),i=new Uint8Array([97,118,99,49]),j=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,h,j,h,i),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,f))}},{key:"box",value:function(b){for(var g,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(g=new Uint8Array(d),g[0]=d>>24&255,g[1]=d>>16&255,g[2]=d>>8&255,g[3]=255&d,g.set(b,4),e=0,d=8;e<f;e++)g.set(c[e],d),d+=c[e].byteLength;return g}},{key:"hdlr",value:function(c){return a.box(a.types.hdlr,a.HDLR_TYPES[c])}},{key:"mdat",value:function(c){return a.box(a.types.mdat,c)}},{key:"mdhd",value:function(c,d){d*=c;var e=Math.floor(d/(f+1)),g=Math.floor(d%(f+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,e>>24,e>>16&255,e>>8&255,255&e,g>>24,g>>16&255,g>>8&255,255&g,85,196,0,0]))}},{key:"mdia",value:function(c){return a.box(a.types.mdia,a.mdhd(c.timescale,c.duration),a.hdlr(c.type),a.minf(c))}},{key:"mfhd",value:function(c){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c]))}},{key:"minf",value:function(c){return"audio"===c.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(c)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(c))}},{key:"moof",value:function(c,d,e){return a.box(a.types.moof,a.mfhd(c),a.traf(e,d))}},{key:"moov",value:function(c){for(var d=c.length,e=[];d--;)e[d]=a.trak(c[d]);return a.box.apply(null,[a.types.moov,a.mvhd(c[0].timescale,c[0].duration)].concat(e).concat(a.mvex(c)))}},{key:"mvex",value:function(c){for(var d=c.length,e=[];d--;)e[d]=a.trex(c[d]);return a.box.apply(null,[a.types.mvex].concat(e))}},{key:"mvhd",value:function(c,d){d*=c;var e=Math.floor(d/(f+1)),g=Math.floor(d%(f+1)),h=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,e>>24,e>>16&255,e>>8&255,255&e,g>>24,g>>16&255,g>>8&255,255&g,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,h)}},{key:"sdtp",value:function(c){var f,g,d=c.samples||[],e=new Uint8Array(4+d.length);for(g=0;g<d.length;g++)f=d[g].flags,e[g+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return a.box(a.types.sdtp,e)}},{key:"stbl",value:function(c){return a.box(a.types.stbl,a.stsd(c),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function(c){var f,g,h,d=[],e=[];for(f=0;f<c.sps.length;f++)g=c.sps[f],h=g.byteLength,d.push(h>>>8&255),d.push(255&h),d=d.concat(Array.prototype.slice.call(g));for(f=0;f<c.pps.length;f++)g=c.pps[f],h=g.byteLength,e.push(h>>>8&255),e.push(255&h),e=e.concat(Array.prototype.slice.call(g));var i=a.box(a.types.avcC,new Uint8Array([1,d[3],d[4],d[5],255,224|c.sps.length].concat(d).concat([c.pps.length]).concat(e))),j=c.width,k=c.height,l=c.pixelRatio[0],m=c.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,j>>8&255,255&j,k>>8&255,255&k,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,m>>24,m>>16&255,m>>8&255,255&m])))}},{key:"esds",value:function(b){var c=b.config.length;return new Uint8Array([0,0,0,0,3,23+c,0,1,0,4,15+c,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([c]).concat(b.config).concat([6,1,2]))}},{key:"mp4a",value:function(c){var d=c.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,c.channelCount,0,16,0,0,0,0,d>>8&255,255&d,0,0]),a.box(a.types.esds,a.esds(c)))}},{key:"mp3",value:function(c){var d=c.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,c.channelCount,0,16,0,0,0,0,d>>8&255,255&d,0,0]))}},{key:"stsd",value:function(c){return"audio"===c.type?c.isAAC||"mp3"!==c.codec?a.box(a.types.stsd,a.STSD,a.mp4a(c)):a.box(a.types.stsd,a.STSD,a.mp3(c)):a.box(a.types.stsd,a.STSD,a.avc1(c))}},{key:"tkhd",value:function(c){var d=c.id,e=c.duration*c.timescale,g=c.width,h=c.height,i=Math.floor(e/(f+1)),j=Math.floor(e%(f+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,d>>24&255,d>>16&255,d>>8&255,255&d,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,j>>24,j>>16&255,j>>8&255,255&j,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,255&g,0,0,h>>8&255,255&h,0,0]))}},{key:"traf",value:function(c,d){var e=a.sdtp(c),g=c.id,h=Math.floor(d/(f+1)),i=Math.floor(d%(f+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,255&g])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i])),a.trun(c,e.length+16+20+8+16+8+8),e)}},{key:"trak",value:function(c){return c.duration=c.duration||4294967295,a.box(a.types.trak,a.tkhd(c),a.mdia(c))}},{key:"trex",value:function(c){var d=c.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(c,d){var i,j,k,l,m,n,e=c.samples||[],f=e.length,g=12+16*f,h=new Uint8Array(g);for(d+=8+g,h.set([0,0,15,1,f>>>24&255,f>>>16&255,f>>>8&255,255&f,d>>>24&255,d>>>16&255,d>>>8&255,255&d],0),i=0;i<f;i++)j=e[i],k=j.duration,l=j.size,m=j.flags,n=j.cts,h.set([k>>>24&255,k>>>16&255,k>>>8&255,255&k,l>>>24&255,l>>>16&255,l>>>8&255,255&l,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,61440&m.degradPrio,15&m.degradPrio,n>>>24&255,n>>>16&255,n>>>8&255,255&n],12+16*i);return a.box(a.types.trun,h)}},{key:"initSegment",value:function(c){a.types||a.init();var e,d=a.moov(c);return e=new Uint8Array(a.FTYP.byteLength+d.byteLength),e.set(a.FTYP),e.set(d,a.FTYP.byteLength),e}}]),a}();c.default=g},{}],37:[function(a,b,c){"use strict";function m(a){return a&&a.__esModule?a:{default:a}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(28),f=m(e),g=a(27),h=m(g),i=a(43),j=a(36),k=m(j),l=a(25),o=function(){function a(b,c,d,e){n(this,a),this.observer=b,this.config=c,this.typeSupported=d;var f=navigator.userAgent;this.isSafari=e&&e.indexOf("Apple")>-1&&f&&!f.match("CriOS"),this.ISGenerated=!1}return d(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(b){this._initPTS=this._initDTS=b}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(b,c,d,e,f,g,i){if(this.ISGenerated||this.generateIS(b,c,f),this.ISGenerated)if(b.samples.length){var j=this.remuxAudio(b,f,g,i);if(c.samples.length){var k=void 0;j&&(k=j.endPTS-j.startPTS),this.remuxVideo(c,f,g,k)}}else{var l=void 0;c.samples.length&&(l=this.remuxVideo(c,f,g)),l&&b.codec&&this.remuxEmptyAudio(b,f,g,l)}d.samples.length&&this.remuxID3(d,f),e.samples.length&&this.remuxText(e,f),this.observer.trigger(h.default.FRAG_PARSED)}},{key:"generateIS",value:function(b,c,d){var q,r,e=this.observer,f=b.samples,g=c.samples,j=this.typeSupported,m="audio/mp4",n={},o={tracks:n},p=void 0===this._initPTS;if(p&&(q=r=1/0),b.config&&f.length&&(b.timescale=b.samplerate,i.logger.log("audio sampling rate : "+b.samplerate),b.isAAC||(j.mpeg?(m="audio/mpeg",b.codec=""):j.mp3&&(b.codec="mp3")),n.audio={container:m,codec:b.codec,initSegment:!b.isAAC&&j.mpeg?new Uint8Array:k.default.initSegment([b]),metadata:{channelCount:b.channelCount}},p&&(q=r=f[0].pts-b.inputTimeScale*d)),c.sps&&c.pps&&g.length){var s=c.inputTimeScale;c.timescale=s,n.video={container:"video/mp4",codec:c.codec,initSegment:k.default.initSegment([c]),metadata:{width:c.width,height:c.height}},p&&(q=Math.min(q,g[0].pts-s*d),r=Math.min(r,g[0].dts-s*d),this.observer.trigger(h.default.INIT_PTS_FOUND,{initPTS:q}))}Object.keys(n).length?(e.trigger(h.default.FRAG_PARSING_INIT_SEGMENT,o),this.ISGenerated=!0,p&&(this._initPTS=q,this._initDTS=r)):e.trigger(h.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(b,c,d,e){var j,m,n,o,p,r,s,f=8,g=b.timescale,t=b.samples,u=[],v=t.length,w=this._PTSNormalize,x=this._initDTS;t.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||(d||a.id-b.id)});var y=t.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(y<0){i.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(y/90)+" ms to overcome this issue");for(var z=0;z<t.length;z++)t[z].dts+=y}var A=void 0;A=d?this.nextAvcDts:c*g;var B=t[0];p=Math.max(w(B.dts-x,A),0),o=Math.max(w(B.pts-x,A),0);var C=Math.round((p-A)/90);d&&C&&(C>1?i.logger.log("AVC:"+C+" ms hole between fragments detected,filling it"):C<-1&&i.logger.log("AVC:"+-C+" ms overlapping between fragments detected"),p=A,t[0].dts=p+x,o=Math.max(o-C,A),t[0].pts=o+x,i.logger.log("Video/PTS/DTS adjusted: "+Math.round(o/90)+"/"+Math.round(p/90)+",delta:"+C+" ms")),B=t[t.length-1],s=Math.max(w(B.dts-x,A),0),r=Math.max(w(B.pts-x,A),0),r=Math.max(r,s);var D=this.isSafari;D&&(j=Math.round((s-p)/(t.length-1)));for(var E=0,F=0,G=0;G<v;G++){for(var H=t[G],I=H.units,J=I.length,K=0,L=0;L<J;L++)K+=I[L].data.length;F+=K,E+=J,H.length=K,H.dts=D?p+G*j:Math.max(w(H.dts-x,A),p),H.pts=Math.max(w(H.pts-x,A),H.dts)}var M=F+4*E+8;try{m=new Uint8Array(M)}catch(a){return void this.observer.trigger(h.default.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M})}var N=new DataView(m.buffer);N.setUint32(0,M),m.set(k.default.types.mdat,4);for(var O=0;O<v;O++){for(var P=t[O],Q=P.units,R=0,S=void 0,T=0,U=Q.length;T<U;T++){var V=Q[T],W=V.data,X=V.data.byteLength;N.setUint32(f,X),f+=4,m.set(W,f),f+=X,R+=4+X}if(D)S=Math.max(0,j*Math.round((P.pts-P.dts)/j));else{if(O<v-1)j=t[O+1].dts-P.dts;else{var Y=this.config,Z=P.dts-t[O>0?O-1:O].dts;if(Y.stretchShortVideoTrack){var $=Y.maxBufferHole,_=Y.maxSeekHole,aa=Math.floor(Math.min($,_)*g),ba=(e?o+e*g:this.nextAudioPts)-P.pts;ba>aa?(j=ba-Z,j<0&&(j=Z),i.logger.log("It is approximately "+ba/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=Z}else j=Z}S=Math.round(P.pts-P.dts)}u.push({size:R,duration:j,cts:S,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:P.key?2:1,isNonSync:P.key?0:1}})}this.nextAvcDts=s+j;var ca=b.dropped;if(b.len=0,b.nbNalu=0,b.dropped=0,u.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var da=u[0].flags;da.dependsOn=2,da.isNonSync=0}b.samples=u,n=k.default.moof(b.sequenceNumber++,p,b),b.samples=[];var ea={data1:n,data2:m,startPTS:o/g,endPTS:(r+j)/g,startDTS:p/g,endDTS:this.nextAvcDts/g,type:"video",nb:u.length,dropped:ca};return this.observer.trigger(h.default.FRAG_PARSING_DATA,ea),ea}},{key:"remuxAudio",value:function(b,c,d,e){var s,u,v,w,x,y,z,A,B,C,D,E,F,I,J,K,g=b.inputTimeScale,j=b.timescale,m=g/j,n=b.isAAC?1024:1152,o=n*m,p=this._PTSNormalize,q=this._initDTS,r=!b.isAAC&&this.typeSupported.mpeg,t=r?0:8,G=[],H=[];if(b.samples.sort(function(a,b){return a.pts-b.pts}),H=b.samples,K=this.nextAudioPts,d|=H.length&&K&&(Math.abs(c-K/g)<.1||Math.abs(H[0].pts-K-q)<20*o),d||(K=c*g),e&&b.isAAC)for(var L=0,M=K;L<H.length;){var N=H[L],O=p(N.pts-q,K),P=O-M;if(P<=-o)i.logger.warn("Dropping 1 audio frame @ "+(M/g).toFixed(3)+"s due to "+Math.abs(1e3*P/g)+" ms overlap."),H.splice(L,1),b.len-=N.unit.length;else if(P>=o&&M){var Q=Math.round(P/o);i.logger.warn("Injecting "+Q+" audio frame @ "+(M/g).toFixed(3)+"s due to "+1e3*P/g+" ms gap.");for(var R=0;R<Q;R++)J=M+q,J=Math.max(J,q),I=f.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount),I||(i.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),I=N.unit.subarray()),H.splice(L,0,{unit:I,pts:J,dts:J}),b.len+=I.length,M+=o,L+=1;N.pts=N.dts=M+q,M+=o,L+=1}else Math.abs(P),M+=o,N.pts=N.dts=0===L?q+K:H[L-1].pts+o,L+=1}for(var S=0,T=H.length;S<T;S++){if(u=H[S],w=u.unit,C=u.pts-q,D=u.dts-q,void 0!==B)E=p(C,B),F=p(D,B),v.duration=Math.round((F-B)/m);else{E=p(C,K),F=p(D,K);var U=Math.round(1e3*(E-K)/g),V=0;if(d&&b.isAAC&&U){if(U>0)V=Math.round((E-K)/o),i.logger.log(U+" ms hole between AAC samples detected,filling it"),V>0&&(I=f.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount),I||(I=w.subarray()),b.len+=V*I.length);else if(U<-12){i.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(K/g).toFixed(3)+"s/"+(E/g).toFixed(3)+"s/"+-U+"ms"),b.len-=w.byteLength;continue}E=F=K}if(z=Math.max(0,E),A=Math.max(0,F),!(b.len>0))return;var W=r?b.len:b.len+8;try{x=new Uint8Array(W)}catch(a){return void this.observer.trigger(h.default.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:W,reason:"fail allocating audio mdat "+W})}r||(s=new DataView(x.buffer),s.setUint32(0,W),x.set(k.default.types.mdat,4));for(var X=0;X<V;X++)J=E-(V-X)*o,I=f.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount),I||(i.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),I=w.subarray()),x.set(I,t),t+=I.byteLength,v={size:I.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},G.push(v)}x.set(w,t);var Y=w.byteLength;t+=Y,v={size:Y,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},G.push(v),B=F}var Z=0,$=G.length;if($>=2&&(Z=G[$-2].duration,v.duration=Z),$){this.nextAudioPts=E+m*Z,b.len=0,b.samples=G,y=r?new Uint8Array:k.default.moof(b.sequenceNumber++,A/m,b),b.samples=[];var _={data1:y,data2:x,startPTS:z/g,endPTS:this.nextAudioPts/g,startDTS:A/g,endDTS:(F+m*Z)/g,type:"audio",nb:$};return this.observer.trigger(h.default.FRAG_PARSING_DATA,_),_}return null}},{key:"remuxEmptyAudio",value:function(b,c,d,e){var g=b.inputTimeScale,h=b.samplerate?b.samplerate:g,j=g/h,k=this.nextAudioPts,l=(void 0!==k?k:e.startDTS*g)+this._initDTS,m=e.endDTS*g+this._initDTS,n=1024,o=j*n,p=Math.ceil((m-l)/o),q=f.default.getSilentFrame(b.manifestCodec||b.codec,b.channelCount);if(i.logger.warn("remux empty Audio"),!q)return void i.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var r=[],s=0;s<p;s++){var t=l+s*o;r.push({unit:q,pts:t,dts:t}),b.len+=q.length}b.samples=r,this.remuxAudio(b,c,d)}},{key:"remuxID3",value:function(b,c){var e,d=b.samples.length,f=b.inputTimeScale,g=this._initPTS,i=this._initDTS;if(d){for(var j=0;j<d;j++)e=b.samples[j],e.pts=(e.pts-g)/f,e.dts=(e.dts-i)/f;this.observer.trigger(h.default.FRAG_PARSING_METADATA,{samples:b.samples})}b.samples=[],c=c}},{key:"remuxText",value:function(b,c){b.samples.sort(function(a,b){return a.pts-b.pts});var e,d=b.samples.length,f=b.inputTimeScale,g=this._initPTS;if(d){for(var i=0;i<d;i++)e=b.samples[i],e.pts=(e.pts-g)/f;this.observer.trigger(h.default.FRAG_PARSING_USERDATA,{samples:b.samples})}b.samples=[],c=c}},{key:"_PTSNormalize",value:function(b,c){var d;if(void 0===c)return b;for(d=c<b?-8589934592:8589934592;Math.abs(b-c)>4294967296;)b+=d;return b}}]),a}();c.default=o},{25:25,27:27,28:28,36:36,43:43}],38:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=g(e),i=function(){function a(b){h(this,a),this.observer=b}return d(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(b,c,d,e,g,h,i,j){var k=this.observer,l="";b&&(l+="audio"),c&&(l+="video"),k.trigger(f.default.FRAG_PARSING_DATA,{data1:j,startPTS:g,startDTS:g,type:l,nb:1,dropped:0}),k.trigger(f.default.FRAG_PARSED)}}]),a}();c.default=i},{27:27}],39:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,h=function(){function a(b){e(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return d(a,[{key:"decimalInteger",value:function(b){var c=parseInt(this[b],10);return c>Number.MAX_SAFE_INTEGER?1/0:c}},{key:"hexadecimalInteger",value:function(b){if(this[b]){var c=(this[b]||"0x").slice(2);c=(1&c.length?"0":"")+c;for(var d=new Uint8Array(c.length/2),e=0;e<c.length/2;e++)d[e]=parseInt(c.slice(2*e,2*e+2),16);return d}return null}},{key:"hexadecimalIntegerAsNumber",value:function(b){var c=parseInt(this[b],16);return c>Number.MAX_SAFE_INTEGER?1/0:c}},{key:"decimalFloatingPoint",value:function(b){return parseFloat(this[b])}},{key:"enumeratedString",value:function(b){return this[b]}},{key:"decimalResolution",value:function(b){var c=f.exec(this[b]);if(null!==c)return{width:parseInt(c[1],10),height:parseInt(c[2],10)}}}],[{key:"parseAttrList",value:function(b){var c,d={};for(g.lastIndex=0;null!==(c=g.exec(b));){var e=c[2],f='"';0===e.indexOf(f)&&e.lastIndexOf(f)===e.length-1&&(e=e.slice(1,-1)),d[c[1]]=e}return d}}]),a}();c.default=h},{}],40:[function(a,b,c){"use strict";var d={search:function(b,c){for(var d=0,e=b.length-1,f=null,g=null;d<=e;){f=(d+e)/2|0,g=b[f];var h=c(g);if(h>0)d=f+1;else{if(!(h<0))return g;e=f-1}}return null}};b.exports=d},{}],41:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(42),f=g(e),i=function(){function a(b,c,d,e){h(this,a),this.hls=b,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new f.default(c),this.fast_=new f.default(d)}return d(a,[{key:"sample",value:function(b,c){b=Math.max(b,this.minDelayMs_);var d=8e3*c/b,e=b/1e3;this.fast_.sample(e,d),this.slow_.sample(e,d)}},{key:"canEstimate",value:function(){var b=this.fast_;return b&&b.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),a}();c.default=i},{42:42}],42:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){e(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return d(a,[{key:"sample",value:function(b,c){var d=Math.pow(this.alpha_,b);this.estimate_=c*(1-d)+d*this.estimate_,this.totalWeight_+=b}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var b=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/b}return this.estimate_}}]),a}();c.default=f},{}],43:[function(a,b,c){"use strict";function e(){}function h(a,b){return b="["+a+"] > "+b}function i(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];d[0]&&(d[0]=h(a,d[0])),b.apply(self.console,d)}:e}function j(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];c.forEach(function(b){g[b]=a[b]?a[b].bind(a):i(b)})}Object.defineProperty(c,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f={trace:e,debug:e,log:e,warn:e,info:e,error:e},g=f;c.enableLogs=function(b){if(!0===b||"object"===(void 0===b?"undefined":d(b))){j(b,"debug","log","info","warn","error");try{g.log()}catch(a){g=f}}else g=f},c.logger=g},{}],44:[function(a,b,c){"use strict";var d={toString:function(b){for(var c="",d=b.length,e=0;e<d;e++)c+="["+b.start(e).toFixed(3)+","+b.end(e).toFixed(3)+"]";return c}};b.exports=d},{}],45:[function(a,b,c){"use strict";function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(43),g=function(){function a(b){f(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return d(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var b=this.loader;b&&4!==b.readyState&&(this.stats.aborted=!0,b.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(b,c,d){this.context=b,this.config=c,this.callbacks=d,this.stats={trequest:performance.now(),retry:0},this.retryDelay=c.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var b,c=this.context;b="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var d=this.stats;d.tfirst=0,d.loaded=0;var e=this.xhrSetup;if(e)try{e(b,c.url)}catch(a){b.open("GET",c.url,!0),e(b,c.url)}b.readyState||b.open("GET",c.url,!0),c.rangeEnd&&b.setRequestHeader("Range","bytes="+c.rangeStart+"-"+(c.rangeEnd-1)),b.onreadystatechange=this.readystatechange.bind(this),b.onprogress=this.loadprogress.bind(this),b.responseType=c.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),b.send()}},{key:"readystatechange",value:function(b){var c=b.currentTarget,d=c.readyState,f=this.stats,g=this.context,h=this.config;if(!f.aborted&&d>=2)if(window.clearTimeout(this.requestTimeout),0===f.tfirst&&(f.tfirst=Math.max(performance.now(),f.trequest)),4===d){var i=c.status;if(i>=200&&i<300){f.tload=Math.max(f.tfirst,performance.now());var j=void 0,k=void 0;"arraybuffer"===g.responseType?(j=c.response,k=j.byteLength):(j=c.responseText,k=j.length),f.loaded=f.total=k;var l={url:c.responseURL,data:j};this.callbacks.onSuccess(l,f,g)}else f.retry>=h.maxRetry||i>=400&&i<499?(e.logger.error(i+" while loading "+g.url),this.callbacks.onError({code:i,text:c.statusText},g)):(e.logger.warn(i+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),f.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),h.timeout)}},{key:"loadtimeout",value:function(){e.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(b){var c=this.stats;c.loaded=b.loaded,b.lengthComputable&&(c.total=b.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null)}}]),a}();c.default=g},{43:43}]},{},[32])(32)});